<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>CGT ‚Äì Founders L0: Roadmap Control (Toggle ‚Ä¢ Spotlight ‚Ä¢ Difficulty)</title>
<style>
  :root{
    --bg:#0b0f14; --ink:#eaf2ff; --muted:#9fb3cc;
    --panel:#121821;
    --stage:#1a2737;
    --border:#203043;
    --accent:#5ee1a2; --danger:#ff6b6b; --ring:#6be9cd;
    --btn:#1b2432; --bar:#1b2634;
    --green:#0e7f55; --green2:#17a46e; --red:#95333a; --red2:#c54650;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:linear-gradient(180deg,#0b0f14,#0e141c);color:var(--ink);font:16px/1.45 ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Arial}
  header{position:sticky;top:0;z-index:5;padding:.75rem 1rem;background:rgba(11,15,20,.82);
         -webkit-backdrop-filter:saturate(140%) blur(10px);backdrop-filter:saturate(140%) blur(10px);
         border-bottom:1px solid #17202b;display:flex;align-items:center;gap:.75rem;flex-wrap:wrap}
  .brand{font-weight:700}
  .chip{font-size:.82rem;color:var(--muted)}
  .hud{margin-left:auto;display:flex;align-items:center;gap:.6rem;flex-wrap:wrap}
  .pill{padding:.25rem .6rem;border:1px solid #243246;border-radius:999px;color:var(--muted);font-size:.82rem}
  .skulls{font-weight:700}
  .bar{width:200px;max-width:50vw;height:8px;background:var(--bar);border:1px solid #223042;border-radius:999px;overflow:hidden}
  .fill{height:100%;width:0;background:linear-gradient(90deg,var(--accent),#6be9cd);transition:width .05s linear}
  main{max-width:860px;margin:0 auto;padding:1rem .75rem 5rem;display:grid;gap:1rem}

  .stage{background:linear-gradient(180deg,#223349,#1a2737);border:1px solid #2a3d56;border-radius:16px;box-shadow:0 18px 40px rgba(0,0,0,.35), inset 0 0 0 1px rgba(255,255,255,.03);padding:1.1rem}
  .card{background:transparent;border:0;border-radius:14px}
  .row{display:grid;gap:.6rem}

  .feature{border:1px dashed #2a3a4e;border-radius:14px;padding:.75rem .9rem}
  .feature.focus{position:relative;background: radial-gradient(1200px 300px at 50% -10%, rgba(111,233,205,.16), transparent 60%), #0f1621;border-color:#345173;box-shadow:0 12px 30px rgba(111,233,205,.12), inset 0 0 0 1px rgba(111,233,205,.08)}
  .tag{font-size:.78rem;color:var(--muted);letter-spacing:.06em;text-transform:uppercase}
  .name{font-weight:800;letter-spacing:.02em}
  .name.big{font-size:1.35rem;text-shadow:0 0 12px rgba(111,233,205,.25)}

  .divider{text-align:center;color:#a7bdd8;letter-spacing:.3em;font-weight:800;opacity:.9;user-select:none;padding:.45rem 0 .2rem;position:relative}
  .divider::before,.divider::after{content:"";position:absolute;top:50%;width:32%;height:1px;background:#263447}
  .divider::before{left:0}.divider::after{right:0}

  .toggleWrap{display:grid;gap:.6rem;align-items:center;justify-items:center}
  .toggleBtn{appearance:none;border:2px solid #2a3a4e;border-radius:16px;cursor:pointer;padding:1.1rem;width:min(560px,96%);font-weight:900;font-size:1.15rem;box-shadow:0 12px 24px rgba(0,0,0,.28);color:#fff;background:var(--btn);transition:transform .06s ease,background .2s ease,border-color .2s ease,filter .1s linear}
  .toggleBtn:active{transform:translateY(1px)}
  .state-before{background:linear-gradient(180deg,var(--green2),var(--green));border-color:#1e6b4b}
  .state-after{background:linear-gradient(180deg,var(--red2),var(--red));border-color:#7a2c33}
  .pulse{animation:pulse .35s ease}
  @keyframes pulse{0%{filter:brightness(1.0)}50%{filter:brightness(1.15)}100%{filter:brightness(1.0)}}

  .skull{font-size:2.2rem;line-height:1}
  .end h2{margin:.2rem 0 .35rem}
  .end .grades{display:flex;gap:.5rem;flex-wrap:wrap;margin-top:.5rem}
  .gradepill{padding:.35rem .6rem;border:1px dashed #32465e;border-radius:999px;color:var(--muted);font-size:.85rem}

  .fab{position:fixed;right:16px;bottom:16px;z-index:10;background:linear-gradient(180deg,#1c2735,#131b26);color:var(--ink);border:1px solid #243246;border-radius:999px;padding:.9rem 1.05rem;font-weight:800;box-shadow:0 12px 24px rgba(0,0,0,.35);cursor:pointer}
  .fab:focus{outline:2px solid #6be9cd;outline-offset:3px}
  .small{font-size:.85rem}

  .overlay{position:fixed;inset:0;background:rgba(6,8,12,.7);-webkit-backdrop-filter:blur(6px);backdrop-filter:blur(6px);display:none;align-items:center;justify-content:center;z-index:20}
  .dialog{background:#0f1621;border:1px solid #253448;border-radius:16px;max-width:560px;width:92%;padding:1rem 1rem 1.1rem;box-shadow:0 20px 50px rgba(0,0,0,.45)}
  .dialog h2{margin:.1rem 0 .2rem;font-size:1.2rem}
  .howto{margin:.3rem 0 .6rem;background:#121c29;border:1px solid #22334a;border-radius:12px;padding:.75rem}
  .howto li{margin:.25rem 0}
  .rowBtn{display:flex;gap:.6rem;flex-wrap:wrap;margin-top:.6rem}
  .pick{flex:1;min-width:150px}

  /* Hint panel under Anchor */
  .hint{
    margin-top:.6rem;
    background:#101825;
    border:1px solid #2a3d56;
    border-radius:12px;
    padding:.8rem .9rem;
    font-size:.95rem;
    line-height:1.35;
    box-shadow:0 10px 24px rgba(0,0,0,.28), inset 0 0 0 1px rgba(255,255,255,.03);
  }
  .hint b{color:#cfe6ff}
</style>
</head>
<body>
<header>
  <div class="brand">üß© CGT ‚Ä¢ Founders L0 ‚Äì Roadmap Control</div>
  <span class="chip">Prototype v0.8 ‚Ä¢ Single-toggle ‚Ä¢ Spotlight ‚Ä¢ Difficulty</span>
  <div class="hud">
    <div class="pill">Score: <span id="score">0</span></div>
    <div class="pill">Streak: <span id="streak">0</span></div>
    <div class="pill skulls">üíÄ <span id="fails">0</span></div>
    <div class="pill">Chances: <span id="chances">5</span>/5</div>
    <div class="bar"><div class="fill" id="timerFill"></div></div>
  </div>
</header>

<main>
  <section class="stage">
    <section class="card">
      <!-- Order: Incoming ‚Üí COMES ‚Üí Toggle ‚Üí Anchor -->
      <div class="row">
        <div class="feature focus">
          <div class="tag">Incoming (decide quickly)</div>
          <div class="name big" id="incomingName">‚Äî</div>
        </div>

        <div class="divider">‚Äî COMES ‚Äî</div>

        <div class="toggleWrap">
          <button id="toggleBtn" class="toggleBtn">BEFORE</button>
        </div>

        <div class="feature focus">
          <div class="tag">Anchor (already placed)</div>
          <div class="name big" id="anchorName">‚Äî</div>
        </div>

        <!-- Hint panel -->
        <div id="hint" class="hint" style="display:none">‚Äî</div>
      </div>
    </section>

    <section class="card end" id="endCard" style="display:none">
      <div class="tag" style="text-transform:uppercase;letter-spacing:.12em">Outcome</div>
      <h2 id="titleOutcome">‚Äî</h2>
      <p class="small" id="descOutcome">‚Äî</p>
      <div class="end grades">
        <span class="gradepill" id="starsPill">‚≠êÔ∏è ‚Äî</span>
        <span class="gradepill">Correct: <span id="correctOut">0</span></span>
        <span class="gradepill">Errors: <span id="failsOut">0</span> üíÄ</span>
        <span class="gradepill">Total: <span id="totalOut">0</span></span>
      </div>
      <div class="end grades" style="margin-top:.6rem">
        <button class="toggleBtn" id="exportBtn" style="width:auto;padding:.6rem .8rem;font-size:.95rem">üì§ Export run (copy JSON)</button>
        <button class="toggleBtn" id="playAgainBtn" style="width:auto;padding:.6rem .8rem;font-size:.95rem">‚Üª Start Again</button>
      </div>
    </section>
  </section>
</main>

<button class="fab" id="restartFab">‚Üª Start Again</button>

<!-- Overlay: Title + How to Play + Difficulty -->
<div class="overlay" id="overlay">
  <div class="dialog">
    <div class="tag">Game</div>
    <h2>Founders L0 ‚Äì Roadmap Control (Before / After Toggle)</h2>

    <div class="tag" style="margin-top:.25rem">How to Play</div>
    <ul class="howto small">
      <li>The large button flips automatically between <b>BEFORE</b> (green) and <b>AFTER</b> (red).</li>
      <li>Tap to <b>lock the current word</b>. You have up to <b>5 flips</b> to choose, or it times out (üíÄ).</li>
      <li>Place the <b>Incoming</b> milestone relative to the <b>Anchor</b> already placed.</li>
      <li>Speed ramps up with streaks and eases after mistakes.</li>
    </ul>

    <div class="tag">Choose speed</div>
    <p class="small" style="color:var(--muted)">Practice = 300% slower ‚Ä¢ Regular = 200% slower ‚Ä¢ Pro = current speed (no hints)</p>
    <div class="rowBtn">
      <button class="toggleBtn pick" data-mode="practice">üü¢ Practice</button>
      <button class="toggleBtn pick" data-mode="regular">üü° Regular</button>
      <button class="toggleBtn pick" data-mode="pro">üî¥ Pro</button>
    </div>
  </div>
</div>

<script>
/* CGT ‚Äì Founders L0: Roadmap Control (Toggle ‚Ä¢ Spotlight ‚Ä¢ Difficulty) */

/* === L0 Roadmap Pack (CryptoGamingToken.com) ============================== */
const FEATURES = [
  // ‚Äî Founders (L0) ‚Äî
  { id:"founder-custody", label:"Founder Custodianship", type:"founders", phase:"mock", dependsOn:[], reasonIfAfter:"Founders set the narrative frame before anything else." },
  { id:"protocol-def-auth", label:"Protocol Definition Authority", type:"founders", phase:"mock", dependsOn:["founder-custody"], reasonIfBefore:"Define boundaries after custodianship sets direction.", reasonIfAfter:"Canon must exist before others can align to it." },
  { id:"roadmap-control", label:"Roadmap Control", type:"founders", phase:"mock", dependsOn:["protocol-def-auth"], reasonIfBefore:"Sequence features after defining what counts as protocol." },

  // ‚Äî Core Developers (L0) ‚Äî
  { id:"dev-mvp-backend", label:"MVP Backend", type:"dev", phase:"mock", dependsOn:["roadmap-control"], reasonIfAfter:"Backend spine must exist to simulate behavior." },
  { id:"dev-mvp-frontend", label:"MVP Frontend", type:"dev", phase:"mock", dependsOn:["dev-mvp-backend"], reasonIfBefore:"Frontend needs a spine to mirror." },
  { id:"wallet-flow-mock", label:"Wallet Flow (Mock)", type:"dev", phase:"mock", dependsOn:["dev-mvp-frontend","dev-mvp-backend"], reasonIfBefore:"Identity hooks rely on working UI + routes." },
  { id:"leaderboard-mock", label:"Leaderboard (Mock)", type:"dev", phase:"mock", dependsOn:["dev-mvp-backend","dev-mvp-frontend","wallet-flow-mock"], reasonIfBefore:"Rankings depend on sessions + submission paths." },
  { id:"score-submit", label:"Score Submission Logic", type:"dev", phase:"mock", dependsOn:["wallet-flow-mock","leaderboard-mock"], reasonIfBefore:"Submission needs identity + a board to land on." },
  { id:"mock-claim-system", label:"Mock Claim System", type:"dev", phase:"mock", dependsOn:["leaderboard-mock","score-submit"], reasonIfBefore:"Claims require finalized placements and stored scores." },
  { id:"explorer-ui", label:"Explorer (Read-Only)", type:"dev", phase:"mock", dependsOn:["leaderboard-mock","mock-claim-system"], reasonIfBefore:"Explorer visualizes existing ranks/claims." },
  { id:"schema-drafts-published", label:"Publish Schema Drafts", type:"dev", phase:"mock", dependsOn:["protocol-def-auth","roadmap-control"], reasonIfBefore:"Schemas reflect canonical definitions and staging." },

  // ‚Äî Players (L0) ‚Äî
  { id:"players-enter-main", label:"Players Enter Main Game", type:"players", phase:"mock", dependsOn:["dev-mvp-frontend","wallet-flow-mock"], reasonIfBefore:"Entry needs UI + session identity." },
  { id:"players-receive-scores", label:"Players Receive Scores", type:"players", phase:"mock", dependsOn:["players-enter-main","score-submit"], reasonIfBefore:"Scores come from play + submission." },
  { id:"players-appear-explorer", label:"Players Appear in Explorer", type:"players", phase:"mock", dependsOn:["explorer-ui","players-receive-scores"], reasonIfBefore:"Explorer needs data to show." },
  { id:"players-claim-mock", label:"Players Claim Mock Rewards", type:"players", phase:"mock", dependsOn:["mock-claim-system","leaderboard-mock","players-receive-scores"], reasonIfBefore:"Claims rely on rank + recorded scores." },

  // ‚Äî Reward Pool Organisers (L0) ‚Äî
  { id:"rpo-view-claim-logic", label:"View Tournament/Claim Logic", type:"organisers", phase:"mock", dependsOn:["leaderboard-mock","mock-claim-system"], reasonIfBefore:"They view after claim/board paths exist." },
  { id:"rpo-simulate-fees", label:"Simulate Fees (No Routing)", type:"organisers", phase:"mock", dependsOn:["rpo-view-claim-logic","schema-drafts-published"], reasonIfBefore:"Fee sims sit on top of visible flows + schema." },

  // ‚Äî Ecosystem Builders (L0) ‚Äî
  { id:"ecosys-see-structure", label:"Ecosystem Sees Structure", type:"ecosystem", phase:"mock", dependsOn:["schema-drafts-published","explorer-ui","mock-claim-system"], reasonIfBefore:"Builders need artifacts to observe." },

  // ‚Äî Service Providers (L0) ‚Äî
  { id:"service-identify-opps", label:"Service: Identify Onboarding Gaps", type:"services", phase:"mock", dependsOn:["ecosys-see-structure","schema-drafts-published"], reasonIfBefore:"Service lens activates once drafts are visible." },

  // ‚Äî DAO & Stakers (L0) ‚Äî
  { id:"dao-passive-monitoring", label:"DAO Passive Monitoring", type:"dao", phase:"mock", dependsOn:["schema-drafts-published","explorer-ui"], reasonIfBefore:"DAO observes after schemas and visibility exist." },
  { id:"stakers-dormant-slot", label:"Stakers: Dormant Commission Slot", type:"stakers", phase:"mock", dependsOn:["schema-drafts-published","rpo-simulate-fees"], reasonIfBefore:"Commission slots ride on schema + fee sims." },
];

const ORDER = FEATURES.map(f=>f.id);
const byId = Object.fromEntries(FEATURES.map(f => [f.id, f]));

// Relationship of A (incoming) relative to B (anchor)
function relationOf(aId, bId){
  const A = byId[aId], B = byId[bId];
  if (A?.dependsOn?.includes(bId)) return "after";   // A depends on B ‚Üí AFTER
  if (B?.dependsOn?.includes(aId)) return "before";  // B depends on A ‚Üí BEFORE
  return ORDER.indexOf(aId) < ORDER.indexOf(bId) ? "before" : "after";
}

function wrongReason(incomingId, anchorId){
  const inc = byId[incomingId], anc = byId[anchorId];
  const correct = relationOf(incomingId, anchorId);
  if (correct === "after" && inc.reasonIfBefore) return inc.reasonIfBefore;
  if (correct === "before" && inc.reasonIfAfter) return inc.reasonIfAfter;
  return `${inc.label} should come ${correct.toUpperCase()} ${anc.label} based on L0 sequencing.`;
}

const BASE_FLIP=900, BASE_MIN=400, BASE_RAMP=50;
const SPEED_MULT = { practice:3.0, regular:2.0, pro:1.0 };

let mode="regular";
let pool=[], anchor=null, incoming=null;
let score=0, streak=0, fails=0, correct=0, totalAsked=0;

let flipIntervalMs=BASE_FLIP, minFlipMs=BASE_MIN, flipRamp=BASE_RAMP;
let roundTimer=null, barTimer=null, sliceElapsed=0;
let currentState="before";
let flipsRemaining=5, maxFlipsPerRound=5;

let paused=false, gameOver=false, hintTimer=null;

const anchorName = document.getElementById("anchorName");
const incomingName = document.getElementById("incomingName");
const hintEl = document.getElementById("hint");
const scoreEl = document.getElementById("score");
const streakEl = document.getElementById("streak");
const failsEl = document.getElementById("fails");
const chancesEl = document.getElementById("chances");
const timerFill = document.getElementById("timerFill");
const toggleBtn = document.getElementById("toggleBtn");
const endCard = document.getElementById("endCard");
const titleOutcome = document.getElementById("titleOutcome");
const descOutcome = document.getElementById("descOutcome");
const starsPill = document.getElementById("starsPill");
const correctOut = document.getElementById("correctOut");
const failsOut = document.getElementById("failsOut");
const totalOut = document.getElementById("totalOut");
const exportBtn = document.getElementById("exportBtn");
const playAgainBtn = document.getElementById("playAgainBtn");
const restartFab = document.getElementById("restartFab");
const overlay = document.getElementById("overlay");

document.querySelectorAll(".pick").forEach(btn=>{
  btn.addEventListener("click", ()=>{
    setDifficulty(btn.dataset.mode);
    overlay.style.display="none";
    hardRestart();
  });
});

function setDifficulty(newMode){
  mode=newMode;
  const mult=SPEED_MULT[mode]||1.0;
  flipIntervalMs=BASE_FLIP*mult;
  minFlipMs=BASE_MIN*mult;
  flipRamp=Math.max(10, Math.round(BASE_RAMP / mult));
}

function shuffle(a){a=a.slice();for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}return a;}

function setState(state){
  currentState=state;
  toggleBtn.textContent=state.toUpperCase();
  toggleBtn.classList.remove("state-before","state-after","pulse");
  toggleBtn.classList.add(state==="before"?"state-before":"state-after");
  requestAnimationFrame(()=>toggleBtn.classList.add("pulse"));
}

function startFlipLoop(){
  if (gameOver) return;
  stopFlipLoop();
  sliceElapsed=0;
  flipsRemaining = maxFlipsPerRound;
  chancesEl.textContent = String(flipsRemaining);

  setState(Math.random()<0.5?"before":"after");

  roundTimer=setInterval(()=>{
    flipsRemaining--;
    chancesEl.textContent = String(flipsRemaining);
    if(flipsRemaining<=0){ timeoutFail(); return; }
    setState(currentState==="before"?"after":"before");
    sliceElapsed=0;
  }, flipIntervalMs);

  barTimer=setInterval(()=>{
    sliceElapsed+=50;
    const pct=Math.max(0,Math.min(100,(sliceElapsed/flipIntervalMs)*100));
    timerFill.style.width=pct+"%";
  },50);
}

function stopFlipLoop(){
  if(roundTimer){clearInterval(roundTimer);roundTimer=null;}
  if(barTimer){clearInterval(barTimer);barTimer=null;}
  timerFill.style.width="0%";
}

function nextRound(){
  if (pool.length === 0){ stopFlipLoop(); showOutcome(); return; }

  if (anchor === null){
    anchor = pool.shift();
    if (pool.length === 0){ stopFlipLoop(); showOutcome(); return; }
  }
  incoming = pool.shift();

  // ‚úÖ set spotlight labels
  anchorName.textContent = byId[anchor]?.label || "‚Äî";
  incomingName.textContent = byId[incoming]?.label || "‚Äî";

  startFlipLoop();
}

function showHint(msg, ms=3200){
  if (mode === "pro") { // Pro: no hints or pause
    setTimeout(nextRound, 220);
    return;
  }
  paused = true;
  toggleBtn.disabled = true;
  stopFlipLoop();
  hintEl.textContent = msg;
  hintEl.style.display = "block";

  clearTimeout(hintTimer);
  hintTimer = setTimeout(()=>resumeGame(), ms);

  const tapToResume = () => { resumeGame(); document.removeEventListener("pointerdown", tapToResume, true); };
  document.addEventListener("pointerdown", tapToResume, true);
}

function resumeGame(){
  if (!paused) return;
  paused = false;
  hintEl.style.display = "none";
  toggleBtn.disabled = false;
  nextRound();
}

function handleClick(){
  if (paused || gameOver) return;

  totalAsked++;
  stopFlipLoop();

  // ‚ö†Ô∏è snapshot the current anchor before we mutate it
  const prevAnchor = anchor;
  const correctRel = relationOf(incoming, prevAnchor);
  const ok = (currentState === correctRel);

  if (ok){
    correct++; streak++; score++;
    flipIntervalMs = Math.max(minFlipMs, flipIntervalMs - flipRamp);
    anchor = incoming;                    // advance anchor
    updateHud();
    setTimeout(nextRound, 220);
  } else {
    fails++; streak = 0; score = Math.max(0, score - 1);
    flipIntervalMs = Math.min(BASE_FLIP * 4, flipIntervalMs + 100);
    flashSkull();

    // üîÅ show the *correct* state on the button during the hint
    setState(correctRel);

    // build the hint message using the *previous* anchor
    const hintMsg = wrongReason(incoming, prevAnchor, currentState);

    // advance anchor for the next round (UI label stays as-is until nextRound)
    anchor = incoming;
    updateHud();

    // pause and show guidance (skips in Pro)
    showHint(hintMsg, 3200);
  }
}

function timeoutFail(){
  if (paused || gameOver) return;

  totalAsked++;
  fails++; streak = 0; score = Math.max(0, score - 1);
  stopFlipLoop();

  // ‚ö†Ô∏è same pattern as wrong-press
  const prevAnchor = anchor;
  const correctRel = relationOf(incoming, prevAnchor);
  setState(correctRel);                   // show the right answer while paused

  flashSkull();

  const hintMsg = wrongReason(incoming, prevAnchor, "timeout");
  anchor = incoming;                      // advance for the next round
  updateHud();
  showHint(hintMsg, 3200);                // pauses (except in Pro)
}
function updateHud(){
  scoreEl.textContent=score;
  streakEl.textContent=streak;
  failsEl.textContent=fails;
}

function flashSkull(){
  const skull=document.createElement("div");
  skull.textContent="üíÄ"; skull.className="skull";
  skull.style.position="fixed"; skull.style.left="50%"; skull.style.top="56%";
  skull.style.transform="translate(-50%,-50%) scale(.9)"; skull.style.opacity="0";
  skull.style.transition="opacity .15s ease, transform .22s ease";
  document.body.appendChild(skull);
  requestAnimationFrame(()=>{skull.style.opacity="1"; skull.style.transform="translate(-50%,-50%) scale(1.1)";});
  setTimeout(()=>{skull.style.opacity="0"; skull.style.transform="translate(-50%,-50%) scale(.9)"; setTimeout(()=>skull.remove(),150);},360);
}

function showOutcome(){
  gameOver = true;
  toggleBtn.disabled = true;

  const total=totalAsked, c=correct;
  let title,desc,stars;
  if(c<=Math.floor(total*0.45)){title="‚≠êÔ∏è Roadmap Rookie";stars="‚≠êÔ∏è 1/3";desc="Sequencing unstable. Rehearse dependencies and readiness signals.";}
  else if(c<=Math.floor(total*0.8)){title="‚≠êÔ∏è‚≠êÔ∏è Sequencing Custodian";stars="‚≠êÔ∏è‚≠êÔ∏è 2/3";desc="Solid order and pacing. Keep avoiding premature activations.";}
  else {title="‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è Protocol Maestro";stars="‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è 3/3";desc="Excellent anticipation of dependencies; staged releases preserve trust.";}

  titleOutcome.textContent=title; descOutcome.textContent=desc; starsPill.textContent=stars;
  correctOut.textContent=c; failsOut.textContent=fails; totalOut.textContent=total;
  endCard.style.display="block";
}

function hardRestart(){
  pool=shuffle(ORDER.slice());
  anchor=null; incoming=null;
  score=0; streak=0; fails=0; correct=0; totalAsked=0;
  gameOver=false; paused=false; hintEl.style.display="none"; toggleBtn.disabled=false;
  endCard.style.display="none";
  updateHud();
  nextRound();
}
function restart(){ overlay.style.display="flex"; }

function exportRun(){
  const payload={
    game:"CGT Founders L0 ‚Äì Roadmap Control (Toggle ‚Ä¢ Spotlight ‚Ä¢ Difficulty)",
    difficulty: mode,
    metrics:{score,correct,fails,totalAsked,finalFlipMs:flipIntervalMs,maxFlipsPerRound},
    timestamp:new Date().toISOString(),
    featuresOrderCanonical:ORDER
  };
  const text=JSON.stringify(payload,null,2);
  navigator.clipboard.writeText(text).then(()=>toast("Run exported to clipboard ‚úÖ")).catch(()=>{toast("Copy failed. Check console.");console.log(text);});
}

function toast(msg){
  const t=document.createElement("div");
  t.textContent=msg;
  t.style.position="fixed";
  t.style.left="50%";
  t.style.bottom="22px";
  t.style.transform="translateX(-50%)";
  t.style.background="#101722";
  t.style.border="1px solid #263448";
  t.style.padding=".6rem .8rem";
  t.style.borderRadius="10px";
  t.style.color="var(--ink)";
  t.style.boxShadow="0 10px 24px rgba(0,0,0,.35)";
  t.style.zIndex="9999";
  t.style.fontSize=".9rem";
  document.body.appendChild(t);
  setTimeout(()=>t.remove(),1600);
}

// events
toggleBtn.addEventListener("click", handleClick);
restartFab.addEventListener("click", restart);
playAgainBtn?.addEventListener("click", restart);
exportBtn?.addEventListener("click", exportRun);

/* Boot: ensure overlay shows even if script loads early */
function boot(){ overlay.style.display="flex"; }
if (document.readyState === "loading"){
  document.addEventListener("DOMContentLoaded", boot, { once:true });
} else { boot(); }
</script>
</body>
</html>
