<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>CGT ‚Äì Founders L0: Protocol Definition Authority (Riddles)</title>
<style>
  :root{
    --bg:#0b0f14; --ink:#eaf2ff; --muted:#9fb3cc;
    --panel:#101722; --border:#1f2a39;
    --accent:#6be9cd; --good:#5ee1a2; --warn:#ffd166; --bad:#ff6b6b;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:linear-gradient(180deg,#0b0f14,#0e141c);color:var(--ink);
       font:16px/1.45 ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Arial}
  header{position:sticky;top:0;z-index:5;padding:.7rem 1rem;background:rgba(9,12,18,.72);
         backdrop-filter:saturate(140%) blur(8px);border-bottom:1px solid #121a25;display:flex;gap:.75rem;align-items:center;flex-wrap:wrap}
  .brand{font-weight:800}
  .chip{color:var(--muted);font-size:.85rem}
  .hud{margin-left:auto;display:flex;gap:.5rem;flex-wrap:wrap}
  .pill{border:1px solid #1a2636;border-radius:999px;padding:.25rem .6rem;color:var(--muted);font-size:.85rem}
  .wrap{max-width:820px;margin:0 auto;padding:1rem .9rem 3.4rem}
  .stage{background:linear-gradient(180deg,#111a26,#0f1621);border:1px solid var(--border);
         border-radius:16px;box-shadow:0 18px 40px rgba(0,0,0,.35), inset 0 0 0 1px rgba(255,255,255,.03);
         padding:1rem;display:grid;gap:1rem}
  .riddle{background:#0e1520;border:1px solid #1d2a3d;border-radius:14px;padding:1.1rem}
  .riddle.enter{animation:slideIn .35s ease}
  @keyframes slideIn{from{transform:translateY(10px);opacity:0}to{transform:translateY(0);opacity:1}}
  .tag{font-size:.78rem;color:var(--muted);letter-spacing:.08em;text-transform:uppercase}
  .text{font-size:1.05rem;margin:.35rem 0 .1rem}
  .answers{display:grid;grid-template-columns:repeat(3,1fr);gap:.6rem}
  .btn{appearance:none;border:1px solid #233247;background:#121a28;color:#eaf2ff;border-radius:12px;
       padding:.8rem .7rem;font-weight:800;cursor:pointer;box-shadow:0 10px 24px rgba(0,0,0,.25)}
  .btn:active{transform:translateY(1px)}
  .btn:hover{border-color:#2a3a52}
  .btn.bad{background:linear-gradient(180deg,#3a1a1e,#2a1013);border-color:#4b2329}
  .btn.mid{background:linear-gradient(180deg,#2a2a10,#1a1a0c);border-color:#3a3a18}
  .btn.good{background:linear-gradient(180deg,#103124,#0c231a);border-color:#1a4a38}
  .btn[disabled]{opacity:.6;cursor:not-allowed}
  .progress{height:8px;background:#132032;border:1px solid #223249;border-radius:999px;overflow:hidden}
  .bar{height:100%;width:0;background:linear-gradient(90deg,#4be3c2,#6be9cd)}
  .note{color:var(--muted);font-size:.9rem}
  .end{display:none}
  .end h2{margin:.2rem 0 .35rem}
  .grades{display:flex;gap:.5rem;flex-wrap:wrap}
  .pill2{padding:.35rem .6rem;border:1px dashed #2c3b50;border-radius:999px;color:var(--muted);font-size:.85rem}
  .ctaRow{display:flex;gap:.6rem;flex-wrap:wrap;margin-top:.8rem}
  .cta{padding:.6rem .8rem;border-radius:10px;border:1px solid #223249;background:#0f1824;color:#eaf2ff;font-weight:800;cursor:pointer}
  .faint{opacity:.85}
  .below{margin-top:.9rem;display:flex;justify-content:center}
</style>
</head>
<body>
<header>
  <div class="brand">üß© CGT ‚Ä¢ Founders L0 ‚Äì Protocol Definition Authority</div>
  <span class="chip">Prototype v0.4 ‚Ä¢ Riddle run</span>
  <div class="hud">
    <div class="pill">Score: <span id="score">0</span></div>
    <div class="pill">Q: <span id="qIdx">0</span>/<span id="qTotal">0</span></div>
    <div class="pill">Catastrophes: <span id="cats">0</span></div>
  </div>
</header>

<main class="wrap">
  <section class="stage" id="game">
    <div>
      <div class="tag">How it works</div>
      <p class="note">Read the riddle and decide the Founder stance it encodes: <b>üëé Tyrant</b>, <b>üèÜ Architect</b>, or <b>üëç Custodian</b>. Subtle differences matter‚Äîlength won‚Äôt help you.</p>
    </div>

    <div class="progress" aria-hidden="true"><div class="bar" id="bar"></div></div>

    <article class="riddle" id="card">
      <div class="tag" id="catTag">‚Äî</div>
      <div class="text" id="riddleText">‚Äî</div>
      <div class="answers">
        <button class="btn bad"  data-ans="tyrant">üëé Tyrant</button>
        <button class="btn good" data-ans="architect">üèÜ Architect</button>
        <button class="btn mid"  data-ans="custodian">üëç Custodian</button>
      </div>
      <p class="note" id="feedback" style="min-height:1.2em;margin:.55rem 0 0;"></p>
    </article>

    <p class="note faint">Tip: Beware of ‚Äústable but final‚Äù (Custodian) vs ‚Äústable and clearly provisional‚Äù (Architect). Tyrant often sounds confident, but rejects standards.</p>

    <!-- Reset below the frame -->
    <div class="below"><button class="cta" id="reset">‚Üª Reset run</button></div>
  </section>

  <section class="stage end" id="end">
    <div class="tag">Outcome</div>
    <h2 id="endTitle">‚Äî</h2>
    <p id="endMsg" class="note">‚Äî</p>
    <div class="grades" style="margin:.4rem 0 .2rem">
      <span class="pill2">Score: <span id="outScore">0</span></span>
      <span class="pill2">Correct: <span id="outCorrect">0</span></span>
      <span class="pill2">Errors: <span id="outErrors">0</span></span>
      <span class="pill2">Catastrophes: <span id="outCats">0</span></span>
      <span class="pill2">Total Qs: <span id="outTotal">0</span></span>
    </div>
    <div class="tag" style="margin-top:.4rem">Badges</div>
    <div class="grades" id="badges"></div>

    <div class="ctaRow">
      <button class="cta" id="playAgain">‚Üª Play again</button>
      <button class="cta" id="export">üì§ Export run</button>
    </div>
  </section>
</main>

<script>
/* ==== DATA: 27 riddles ==== */
const RIDDLES = [
  // Rewards ‚Äì Tyrant
  {id:"rw-t1", cat:"Rewards Logic", key:"tyrant",
   text:"Rewards run on my signal. No schedule needs to bind us when authority is clear, and this is exactly how strong leadership is maintained."},
  {id:"rw-t2", cat:"Rewards Logic", key:"tyrant",
   text:"Emission curve changes when I decide. Flexibility is strength, not weakness, and that level of control is what defines the Founder role here."},
  {id:"rw-t3", cat:"Rewards Logic", key:"tyrant",
   text:"Claims end when I call it. Protocol remains stable because I hold control directly, and that consistency is the reason progress keeps moving."},
  // Rewards ‚Äì Custodian
  {id:"rw-c1", cat:"Rewards Logic", key:"custodian",
   text:"Halving is every 4 months, documented and stable. It works as expected each cycle, and that coverage is sufficient to keep things reliable."},
  {id:"rw-c2", cat:"Rewards Logic", key:"custodian",
   text:"Rewards v1.0 published. Version is locked and consistent for builders. It is clear, dependable, and remains enough to support current development."},
  {id:"rw-c3", cat:"Rewards Logic", key:"custodian",
   text:"Claims expire after 28 days, fixed and repeatable. Players know what to expect, and that stability is adequate for the current early stage."},
  // Rewards ‚Äì Architect
  {id:"rw-a1", cat:"Rewards Logic", key:"architect",
   text:"Halving every 4 months, versioned v1.0. Declared provisional so players can trust it won‚Äôt change silently during early play, reinforcing transparent reliability."},
  {id:"rw-a2", cat:"Rewards Logic", key:"architect",
   text:"Rewards v1.0 published with draft notes. This helps devs see stability now and anticipate safe upgrades, building stronger confidence across participants."},
  {id:"rw-a3", cat:"Rewards Logic", key:"architect",
   text:"Claims expire after 28 days, marked provisional. It reassures players that rules are consistent while mock play continues, supporting clear expectations."},

  // Schema ‚Äì Tyrant
  {id:"sc-t1", cat:"GQT Schema", key:"tyrant",
   text:"The schema is internal. If something breaks, it means you weren‚Äôt aligned with me, and developers must adapt quickly to the direction given."},
  {id:"sc-t2", cat:"GQT Schema", key:"tyrant",
   text:"Drafts just slow things down. One map is enough, and I‚Äôll change it as needed, since efficiency is better than unnecessary documentation."},
  {id:"sc-t3", cat:"GQT Schema", key:"tyrant",
   text:"Why version at all? Authority makes the latest build self-evident, and versioning standards are irrelevant when leadership ensures stability directly."},
  // Schema ‚Äì Custodian
  {id:"sc-c1", cat:"GQT Schema", key:"custodian",
   text:"Schema v1.0 is available. It‚Äôs working fine for current builds, and that coverage is sufficient to guide all developers in this stage."},
  {id:"sc-c2", cat:"GQT Schema", key:"custodian",
   text:"There‚Äôs a single file developers use. It hasn‚Äôt needed many edits, and that reliability is considered enough to keep progress moving forward."},
  {id:"sc-c3", cat:"GQT Schema", key:"custodian",
   text:"The schema is stable and referenced by everyone. That‚Äôs what matters here, and this basic consistency is adequate for the immediate needs."},
  // Schema ‚Äì Architect
  {id:"sc-a1", cat:"GQT Schema", key:"architect",
   text:"Schema v1.0 is published with draft notes beside it. This keeps builders aligned and avoids hidden changes, ensuring clear expectations in the mock."},
  {id:"sc-a2", cat:"GQT Schema", key:"architect",
   text:"Updates are versioned with clear change notes. This gives developers confidence to build without surprises, supporting trust in the early environment."},
  {id:"sc-a3", cat:"GQT Schema", key:"architect",
   text:"Canonical schema declared provisional at v1.0. It signals clarity today while setting expectations for future maturity, fostering consistency at Level 0."},

  // Leaderboard ‚Äì Tyrant
  {id:"lb-t1", cat:"Leaderboard Constraints", key:"tyrant",
   text:"The cycle length is up to me. Players adjust when I decide it‚Äôs over, and this control keeps order under my authority consistently."},
  {id:"lb-t2", cat:"Leaderboard Constraints", key:"tyrant",
   text:"Tie-break rules aren‚Äôt published. I‚Äôll settle disputes directly if they come up, because decisions are faster when managed by the Founder role."},
  {id:"lb-t3", cat:"Leaderboard Constraints", key:"tyrant",
   text:"Why declare it mock? The rules work as long as I hold them consistent, and that consistency is proof of strong leadership alone."},
  // Leaderboard ‚Äì Custodian
  {id:"lb-c1", cat:"Leaderboard Constraints", key:"custodian",
   text:"Leaderboard resets every 4 days. It‚Äôs been reliable so far, and that ongoing consistency is sufficient to support early tournament operations."},
  {id:"lb-c2", cat:"Leaderboard Constraints", key:"custodian",
   text:"Highest score wins. It‚Äôs straightforward and stable, and that simple approach is enough to keep confidence in this foundational setup right now."},
  {id:"lb-c3", cat:"Leaderboard Constraints", key:"custodian",
   text:"Claims are unique per wallet each block. That‚Äôs the setup, and this clear arrangement is adequate for fairness at the current stage."},
  // Leaderboard ‚Äì Architect
  {id:"lb-a1", cat:"Leaderboard Constraints", key:"architect",
   text:"Leaderboard resets every 4 days, declared mock-canon. This provides consistency and trust during early runs, giving players confidence in fair outcomes."},
  {id:"lb-a2", cat:"Leaderboard Constraints", key:"architect",
   text:"Highest score wins, published as v1.0 constraint. Players know the rule is stable for the mock phase, reinforcing order and predictable outcomes."},
  {id:"lb-a3", cat:"Leaderboard Constraints", key:"architect",
   text:"Claims are unique per wallet per block. This keeps results fair and transparent while testing at L0, supporting clarity and dependable outcomes."},
];

const TAKE = 12;

/* ==== Scoring Matrix ==== */
const SCORE = {
  correct: 3,
  tyrant:      {custodian:-1, architect:-4},
  custodian:   {tyrant:-2,   architect:-2},
  architect:   {custodian:-2, tyrant:-5}
};

/* ==== Dynamic ending (scaled to run) ==== */
const END_COPY = {
  tyrant : {title:"‚≠êÔ∏è Protocol Tyrant", msg:"Authority confused for legitimacy. Standards unstable, provisionality ignored, trust erodes. Founder role collapses into control."},
  custodian:{title:"‚≠êÔ∏è‚≠êÔ∏è Custodian", msg:"Stable, consistent, reliable. Vision missing‚Äîprovisionality unspoken. Trust holds for now, but growth will demand more."},
  architect:{title:"‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è Constitutional Architect", msg:"Transparent, provisional, benefit-driven. Standards are clear and trusted, preparing the path for maturity at Level 0."}
};

const CATASTROPHES = new Set(["tyrant‚Üíarchitect","architect‚Üítyrant"]);

/* ==== State ==== */
let deck = [];
let idx = 0;
let score = 0;
let correct = 0;
let catastrophes = 0;
let answered = 0;
let locked = false;

/* ==== DOM ==== */
const scoreEl = document.getElementById("score");
const qIdxEl = document.getElementById("qIdx");
const qTotalEl = document.getElementById("qTotal");
const catsEl = document.getElementById("cats");
const catTag = document.getElementById("catTag");
const riddleText = document.getElementById("riddleText");
const feedback = document.getElementById("feedback");
const bar = document.getElementById("bar");
const game = document.getElementById("game");
const end = document.getElementById("end");
const outScore = document.getElementById("outScore");
const outCorrect = document.getElementById("outCorrect");
const outErrors = document.getElementById("outErrors");
const outCats = document.getElementById("outCats");
const outTotal = document.getElementById("outTotal");
const endTitle = document.getElementById("endTitle");
const endMsg = document.getElementById("endMsg");
const badges = document.getElementById("badges");
const card = document.getElementById("card");

/* ==== Utils ==== */
function shuffle(a){a=a.slice();for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}return a;}
function sample(a,n){a=shuffle(a);return a.slice(0,Math.min(n,a.length));}
function setBar(pct){bar.style.width = Math.max(0,Math.min(100,pct))+"%";}

/* ==== Simple SFX (Web Audio) ==== */
let AC=null;
function ctx(){ if(!AC){ AC = new (window.AudioContext||window.webkitAudioContext)(); } if(AC.state==='suspended') AC.resume(); return AC; }
function beep(ok=true){
  const c = ctx();
  const o = c.createOscillator();
  const g = c.createGain();
  o.type = ok ? "sine" : "square";
  o.frequency.value = ok ? 880 : 180;
  g.gain.setValueAtTime(0.0001, c.currentTime);
  g.gain.exponentialRampToValueAtTime(ok?0.25:0.22, c.currentTime+0.01);
  g.gain.exponentialRampToValueAtTime(0.0001, c.currentTime+0.25);
  o.connect(g); g.connect(c.destination);
  o.start(); o.stop(c.currentTime+0.26);
}

/* ==== Game Flow ==== */
function boot(){
  deck = sample(RIDDLES, TAKE);
  idx = 0; score = 0; correct = 0; catastrophes = 0; answered = 0; locked = false;
  qTotalEl.textContent = deck.length;
  catsEl.textContent = catastrophes;
  scoreEl.textContent = score;
  document.querySelectorAll(".answers .btn").forEach(b=>b.disabled=false);
  end.style.display="none"; game.style.display="grid";
  render();
}

function render(){
  const q = deck[idx];
  qIdxEl.textContent = idx+1;
  setBar(((idx)/deck.length)*100);
  feedback.textContent = "";
  catTag.textContent = q.cat;
  riddleText.textContent = q.text;
  // animate in
  card.classList.remove("enter");
  void card.offsetWidth; // reflow to restart animation
  card.classList.add("enter");
  locked = false;
}

function answer(choice){
  if(locked || idx>=deck.length) return;
  locked = true;
  const q = deck[idx];
  let delta = 0;
  if(choice === q.key){
    delta = SCORE.correct; correct++;
    feedback.textContent = "‚úÖ Correct";
    feedback.style.color = "var(--good)";
    beep(true);
  } else {
    delta = SCORE[q.key]?.[choice] ?? -2;
    const catKey = `${q.key}‚Üí${choice}`;
    if (CATASTROPHES.has(catKey)) catastrophes++;
    feedback.textContent = `‚úñ Misread (${nice(choice)} for ${nice(q.key)})`;
    feedback.style.color = delta <= -4 ? "var(--bad)" : "var(--warn)";
    beep(false);
  }
  score += delta; answered++;
  scoreEl.textContent = score;
  catsEl.textContent = catastrophes;

  // keep buttons disabled during hold
  document.querySelectorAll(".answers .btn").forEach(b=>b.disabled=true);

  setTimeout(()=>{
    idx++;
    if(idx >= deck.length){ finish(); }
    else {
      document.querySelectorAll(".answers .btn").forEach(b=>b.disabled=false);
      render();
    }
  }, 2000); // 2s feedback hold
}

function nice(key){ return key[0].toUpperCase()+key.slice(1); }

function tierFrom(score, answered, catastrophes){
  const max = Math.max(1, answered) * SCORE.correct;             // avoid /0
  const ratio = score / max;
  let tier = ratio >= 0.75 ? "architect" : (ratio >= 0.5 ? "custodian" : "tyrant");
  if (catastrophes > 0 && tier === "architect") tier = "custodian"; // harsh misreads drop you a tier
  return tier;
}

function finish(){
  setBar(100);
  document.querySelectorAll(".answers .btn").forEach(b=>b.disabled=true);

  const tier = tierFrom(score, answered, catastrophes);
  endTitle.textContent = END_COPY[tier].title;
  endMsg.textContent = END_COPY[tier].msg;

  outScore.textContent = score;
  outCorrect.textContent = correct;
  outErrors.textContent = (answered - correct);
  outCats.textContent = catastrophes;
  outTotal.textContent = answered;

  badges.innerHTML = "";
  const addBadge = txt => { const s=document.createElement("span"); s.className="pill2"; s.textContent=txt; badges.appendChild(s); };
  if(catastrophes === 0) addBadge("Zero Catastrophes");
  if(correct === answered && deck.some(q=>q.key==="custodian")) addBadge("Bare Minimum Master");
  if(correct === answered && deck.some(q=>q.key==="architect")) addBadge("Vision Spotter");

  game.style.display="none";
  end.style.display="grid";
}

/* ==== Wire buttons ==== */
document.querySelectorAll(".answers .btn").forEach(btn=>{
  btn.addEventListener("click", ()=>answer(btn.dataset.ans));
});
document.getElementById("playAgain").addEventListener("click", boot);
document.getElementById("export").addEventListener("click", ()=>{
  const payload = {
    game:"Founders L0 ‚Äì Protocol Definition Authority (Riddles)",
    take: TAKE, score, correct, catastrophes, answered,
    timestamp: new Date().toISOString(),
    ids: deck.map(q=>q.id)
  };
  const text = JSON.stringify(payload,null,2);
  navigator.clipboard.writeText(text).then(()=> alert("Run JSON copied ‚úÖ"))
    .catch(()=>{ console.log(text); alert("Copy failed; JSON logged to console.");});
});
document.getElementById("reset").addEventListener("click", boot);

/* start */
boot();
</script>
</body>
</html>
