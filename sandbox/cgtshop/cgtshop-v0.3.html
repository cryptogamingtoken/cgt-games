<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>CGT Shop — Price-Driven Cinematic MVP</title>
<style>
  :root{
    --bg:#0b0f14; --surface:#0f1620; --ink:#e6edf3; --ink-dim:#9fb0c2; --line:#223041;
    --good:#7cf08a; --bad:#ff8a8a; --hint:#c8d6e5; --accent:#2a7bd4;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}
  .wrap{min-height:100%;display:flex;flex-direction:column}
  header{
    display:flex;align-items:center;justify-content:space-between;
    padding:14px 18px;border-bottom:1px solid var(--line);background:rgba(15,22,32,.7);backdrop-filter:blur(6px);
    position:sticky;top:0;z-index:5
  }
  .pill{padding:6px 10px;border:1px solid var(--line);border-radius:999px;margin-right:8px;white-space:nowrap}
  .hud{display:flex;gap:8px;flex-wrap:wrap}
  .k{opacity:.7;margin-right:6px}
  .v{font-weight:700}
  .stage{
    flex:1;display:flex;align-items:center;justify-content:center;padding:24px
  }
  .card{
    width:min(980px,100%);min-height:70vh;
    display:flex;flex-direction:column;justify-content:center;align-items:center;
    background:linear-gradient(180deg, #0f1620 0%, #0c121a 100%);
    border:1px solid var(--line);border-radius:18px;padding:24px 18px;position:relative;overflow:hidden
  }
  .headline{
    font-size:clamp(22px,4.2vw,40px);font-weight:800;letter-spacing:.3px;text-align:center;margin:0;
    opacity:0;transform:translateX(40vw);
    animation: slideAcross 1.6s ease-out forwards;
  }
  @keyframes slideAcross{
    0%{opacity:0;transform:translateX(40vw)}
    15%{opacity:1}
    85%{opacity:1;transform:translateX(-40vw)}
    100%{opacity:1;transform:translateX(0)}
  }
  .sub{color:var(--ink-dim);max-width:820px;text-align:center;margin:12px 0 14px;opacity:0;animation: fadeIn .7s .9s forwards}
  .hint{margin:10px 0 18px;padding:12px;border-left:4px solid #3a516a;background:#101a24;border-radius:8px;color:var(--hint);opacity:0;animation: fadeIn .7s 1.1s forwards}
  @keyframes fadeIn{to{opacity:1}}
  .panel{width:100%;max-width:820px;margin-top:8px;opacity:0;animation: fadeIn .7s 1.25s forwards}
  .panel-inner{background:#111a27;border:1px solid var(--line);border-radius:14px;padding:16px}
  .row{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
  .controls{display:flex;align-items:center;gap:12px;flex-wrap:wrap;margin-top:10px}
  .btn{cursor:pointer;border:1px solid var(--line);background:#122034;color:var(--ink);padding:10px 14px;border-radius:10px}
  .btn:hover{background:#162a43}
  .label{opacity:.75}
  input[type="range"]{width:100%}
  .outcome{margin-top:16px;padding:16px;border-radius:12px;border:1px solid var(--line)}
  .good{background:#0f1c14;border-color:#234333;color:var(--good)}
  .bad{background:#1c0f10;border-color:#432326;color:var(--bad)}
  .center{display:flex;justify-content:center;gap:10px;margin-top:12px}
  .big{font-size:clamp(18px,2.5vw,26px);font-weight:800}
  .muted{opacity:.8}
  .unit{opacity:.85}
  .grow{flex:1}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="pill"><span class="k">Day</span><span class="v" id="day">1</span></div>
    <div class="hud">
      <div class="pill"><span class="k">Price</span><span class="v" id="price">$0.00002857</span></div>
      <div class="pill"><span class="k">Market Cap</span><span class="v" id="mc">$10,000</span></div>
    </div>
  </header>

  <main class="stage">
    <section class="card">
      <h1 class="headline" id="title">Loading…</h1>
      <p class="sub" id="copy"></p>
      <div class="hint" id="forecast">No signals today.</div>

      <div class="panel">
        <div class="panel-inner">
          <div id="intensityBlock">
            <!-- dynamic intensity UI goes here -->
          </div>

          <div class="controls">
            <button class="btn" id="commit">Commit</button>
            <span class="muted">Your choice sets intensity; outcome moves <b>price</b> directly.</span>
          </div>

          <div id="reveal" style="display:none;">
            <div id="outcomeBox" class="outcome"></div>
            <div class="center">
              <button class="btn" id="next">Next day</button>
              <button class="btn" id="restart" style="display:none;">Restart</button>
            </div>
          </div>
        </div>
      </div>

    </section>
  </main>
</div>

<script>
/** ---------- Core State ---------- **/
const SUPPLY = 350_000_000; // fixed
let day = 1;
let price = 10_000 / SUPPLY; // seed via MC / supply (≈ $0.0000285714)
function mc(){ return price * SUPPLY; }
function fmtUSD(n, d=8){
  const opts = {minimumFractionDigits:0, maximumFractionDigits: (n<1? d:2)};
  return '$' + (n).toLocaleString(undefined, opts);
}

/** ---------- Scenario Model ----------
 Each scenario defines:
 - intensity: UI type + range (e.g., quantity for creators, percent for budget share)
 - outcomes: weighted multiplier buckets applied to PRICE directly
   Example multiplier 0.15 → price * 0.15 (−85%)
           multiplier 2.4  → price * 2.4  (+140%)
 - volScale: how much intensity amplifies upside AND downside
------------------------------------- **/
const scenarios = [
  {
    id:"creators-launch",
    title:"3rd-Party Creators — New GQTs Launch",
    copy:"Creators are ready to publish new GQTs today. If the feed catches, demand spikes; if timing clashes, listings get ignored.",
    stakeholder:"3rd-Party Creators",
    intensity:{ type:"quantity", label:"How many GQTs launch today?", min:1000, max:100000, step:1000, unit:"GQTs" },
    outcomes:[
      {label:"Ignored by feed", multRange:[0.20,0.60], weight:20},  // big drop
      {label:"Muted interest",  multRange:[0.60,0.95], weight:35},  // small drop
      {label:"Solid traction",  multRange:[1.10,1.80], weight:35},  // healthy rise
      {label:"Explosive hype",  multRange:[2.00,3.50], weight:10}   // moon
    ],
    hints:["Feed activity looks hot","Competing events rumored","No clear signals"],
    volScale: 0.65
  },
  {
    id:"dev-stability",
    title:"Core Devs — Stability Release",
    copy:"Minor upgrade reduces friction and boosts confidence if clean; a hidden bug could spark sell pressure.",
    stakeholder:"Core Devs",
    intensity:{ type:"percent", label:"How much effort to release testing %?", min:0, max:100, step:5, unit:"%" },
    outcomes:[
      {label:"Quietly reassuring", multRange:[1.05,1.25], weight:55},
      {label:"Neutral impact",     multRange:[0.95,1.05], weight:35},
      {label:"Bug backlash",       multRange:[0.40,0.85], weight:10}
    ],
    hints:["Infra feels solid","Code freeze jitters","No signals"],
    volScale: 0.35
  },
  {
    id:"players-weekend",
    title:"Players — Weekend Tournament Wave",
    copy:"Community organisers rally players. If streamers pick it up, wallets surge; if overshadowed, attention fades.",
    stakeholder:"Players",
    intensity:{ type:"quantity", label:"How many weekend events?", min:10, max:800, step:10, unit:"events" },
    outcomes:[
      {label:"Overshadowed", multRange:[0.30,0.75], weight:25},
      {label:"Steady flow",  multRange:[1.08,1.40], weight:50},
      {label:"Breakout run", multRange:[1.80,3.00], weight:25}
    ],
    hints:["Noise rising","Big streamer may join","No signals"],
    volScale: 0.55
  },
  {
    id:"reg-fog",
    title:"Regulatory Fog — Rumour Mill",
    copy:"Sector-wide review whispers. Could blow over or cause panic. Aggression today magnifies both outcomes.",
    stakeholder:"Founders/Reg",
    intensity:{ type:"percent", label:"How bold is comms posture?", min:0, max:100, step:5, unit:"%" },
    outcomes:[
      {label:"Flash panic",  multRange:[0.10,0.50], weight:15},
      {label:"Caution day",  multRange:[0.70,0.98], weight:50},
      {label:"False alarm",  multRange:[1.00,1.15], weight:25},
      {label:"Counter-rally",multRange:[1.30,2.20], weight:10}
    ],
    hints:["Regulatory fog ahead","Industry quiet","No signals"],
    volScale: 0.75
  }
];

/** ---------- Weighted helpers ---------- **/
function pickWeighted(arr){
  const total = arr.reduce((s,o)=>s+o.weight,0);
  let r = Math.random()*total;
  for(const o of arr){ if((r-=o.weight)<=0) return o; }
  return arr[0];
}
function rand(min,max){ return Math.random()*(max-min)+min; }
function choose(arr){ return arr[Math.floor(Math.random()*arr.length)] }

/** ---------- UI refs ---------- **/
const elDay = document.getElementById('day');
const elPrice = document.getElementById('price');
const elMC = document.getElementById('mc');
const elTitle = document.getElementById('title');
const elCopy = document.getElementById('copy');
const elForecast = document.getElementById('forecast');
const elIntensityBlock = document.getElementById('intensityBlock');
const elCommit = document.getElementById('commit');
const elReveal = document.getElementById('reveal');
const elOutcomeBox = document.getElementById('outcomeBox');
const elNext = document.getElementById('next');
const elRestart = document.getElementById('restart');

let scenario = null;
let intensityValue = 0;
let locked = false;

/** ---------- Rendering ---------- **/
function updateTop(){
  elDay.textContent = day;
  elPrice.textContent = fmtUSD(price, 8);
  elMC.textContent = fmtUSD(mc());
}
function renderIntensityUI(intensity){
  elIntensityBlock.innerHTML = "";
  const wrap = document.createElement('div');

  const label = document.createElement('div');
  label.className = 'label'; label.textContent = intensity.label;
  wrap.appendChild(label);

  const row = document.createElement('div'); row.className = 'row';
  const left = document.createElement('div'); left.className='big'; left.id='intensityVal';
  const right = document.createElement('div'); right.className='grow';

  if(intensity.type === 'quantity'){
    intensityValue = intensity.min;
    left.textContent = `${intensityValue.toLocaleString()} ${intensity.unit}`;
    const input = document.createElement('input');
    input.type='range'; input.min=intensity.min; input.max=intensity.max; input.step=intensity.step; input.value=intensityValue;
    input.oninput = (e)=>{ intensityValue = Number(e.target.value); left.textContent=`${intensityValue.toLocaleString()} ${intensity.unit}`; };
    right.appendChild(input);
  } else { // percent
    intensityValue = intensity.min;
    left.textContent = `${intensityValue}${intensity.unit}`;
    const input = document.createElement('input');
    input.type='range'; input.min=intensity.min; input.max=intensity.max; input.step=intensity.step; input.value=intensityValue;
    input.oninput = (e)=>{ intensityValue = Number(e.target.value); left.textContent=`${intensityValue}${intensity.unit}`; };
    right.appendChild(input);
  }

  row.appendChild(left); row.appendChild(right);
  wrap.appendChild(row);
  elIntensityBlock.appendChild(wrap);
}

/** ---------- Scenario Flow ---------- **/
function newScenario(){
  scenario = choose(scenarios);

  // Reset animation (force reflow to retrigger)
  elTitle.style.animation='none'; void elTitle.offsetWidth; elTitle.style.animation=null;

  elTitle.textContent = scenario.title;
  elCopy.textContent  = scenario.copy;

  // 60% show hint; 40% none
  if(Math.random()<0.6){
    const hint = choose(scenario.hints);
    const flag = Math.random()<0.55 ? " (probable)": " (uncertain)";
    elForecast.textContent = hint + flag;
  } else {
    elForecast.textContent = "No signals today.";
  }

  renderIntensityUI(scenario.intensity);
  elReveal.style.display='none';
  elOutcomeBox.className='outcome';
  locked=false;
}

function applyOutcome(){
  // Pick bucket then sample multiplier within range
  const bucket = pickWeighted(scenario.outcomes);
  let mult = rand(bucket.multRange[0], bucket.multRange[1]);

  // Volatility scales with intensity (linear mapping 0..1)
  // Normalize intensity to 0..1 within the scenario bounds
  let norm = 0;
  if(scenario.intensity.type==='quantity'){
    const {min,max} = scenario.intensity;
    norm = (intensityValue - min) / (max - min);
  } else { // percent
    const {min,max} = scenario.intensity;
    norm = (intensityValue - min) / (max - min);
  }
  norm = Math.max(0, Math.min(1, norm));

  // Stretch multiplier towards extremes with volScale
  // Example: base mult = 1.2, volScale=0.65, norm=0.8 → bump up to ~1.2 + (0.65*0.8*(1.2-1)) or likewise if below 1
  const vs = scenario.volScale || 0.5;
  if(mult >= 1){
    mult = 1 + (mult-1) * (1 + vs*norm); // amplify upside
  } else {
    mult = 1 - (1 - mult) * (1 + vs*norm); // amplify downside
    mult = Math.max(0, mult); // floor at 0
  }

  // Update price directly
  const oldPrice = price;
  price = price * mult;
  // prevent infinitesimal price collapse rounding to zero
  price = Math.max(price, 0);

  // Build outcome UI
  elReveal.style.display = 'block';
  const cls = (price >= oldPrice) ? 'outcome good' : 'outcome bad';
  elOutcomeBox.className = cls;

  const pct = ((mult-1)*100).toFixed(1).replace('-0.0','0.0');
  const deltaMC = mc() - (oldPrice * SUPPLY);
  elOutcomeBox.innerHTML = `
    <div class="big">${bucket.label} &nbsp; (${pct}%)</div>
    <div>Price: <b>${fmtUSD(oldPrice,8)}</b> → <b>${fmtUSD(price,8)}</b></div>
    <div class="muted">Market Cap: <b>${fmtUSD(oldPrice*SUPPLY)}</b> → <b>${fmtUSD(mc())}</b> (${deltaMC>=0?'+':''}${fmtUSD(Math.abs(deltaMC))})</div>
  `;

  // Game over if price hits ~0
  if(price<=0){
    elNext.style.display='none';
    elRestart.style.display='inline-block';
  }else{
    elNext.style.display='inline-block';
    elRestart.style.display='none';
  }
  updateTop();
}

function nextDay(){
  if(price<=0) return;
  day += 1;
  updateTop();
  newScenario();
}

function restart(){
  day = 1;
  price = 10_000 / SUPPLY;
  updateTop();
  newScenario();
}

/** ---------- Init ---------- **/
(function init(){
  updateTop();
  newScenario();
  elCommit.addEventListener('click', ()=>{ if(!locked){ locked=true; applyOutcome(); }});
  elNext.addEventListener('click', nextDay);
  elRestart.addEventListener('click', restart);
})();
</script>
</body>
</html>
