<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CGT Shop v0.8</title>
<style>
  :root{
    --bg:#0a0f14;
    --surface:#0f1620;
    --ink:#e6edf3;
    --ink-dim:#9fb0c2;
    --line:#223041;
    --good:#7cf08a;
    --bad:#ff8a8a;
    --hint:#c8d6e5
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    background:var(--bg);
    color:var(--ink);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif
  }

  /* Header */
  header{
    position:sticky;
    top:0;
    z-index:10;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    padding:12px 16px;
    background:rgba(15,22,32,.78);
    backdrop-filter:blur(8px);
    border-bottom:1px solid var(--line)
  }
  .hud{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  .pill{
    padding:6px 10px;
    border:1px solid var(--line);
    border-radius:999px;
    white-space:nowrap
  }
  .k{opacity:.7;margin-right:6px}
  .v{font-weight:700}
  .brand-badge{
    display:inline-flex;
    align-items:center;
    justify-content:center;
    height:42px;
    padding:0 18px;
    border-radius:999px;
    border:1px solid var(--line);
    background:#101a24;
    color:#a7c7ff;
    font-weight:900;
    letter-spacing:.6px;
    font-size:18px;
    box-shadow:0 0 0 2px rgba(42,123,212,.08) inset
  }

  /* Stage */
  .stage{
    min-height:calc(100% - 70px);
    display:flex;
    align-items:center;
    justify-content:center;
    padding:18px
  }
  .card{
    width:min(980px,100%);
    min-height:72vh;
    background:linear-gradient(180deg,#0f1620 0%,#0c121a 100%);
    border:1px solid var(--line);
    border-radius:18px;
    padding:20px 18px;
    position:relative;
    overflow:hidden;
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center
  }

  /* Cinematic headline */
  .headline{
    font-size:clamp(22px,4.4vw,42px);
    font-weight:900;
    letter-spacing:.3px;
    text-align:center;
    margin:0 10px 8px;
    opacity:0;
    transform:translateX(40vw);
    animation:slideAcross 1.6s ease-out forwards
  }
  @keyframes slideAcross{
    0%{opacity:0;transform:translateX(40vw)}
    15%{opacity:1}
    85%{opacity:1;transform:translateX(-40vw)}
    100%{opacity:1;transform:translateX(0)}
  }
  .type{
    color:var(--ink-dim);
    max-width:820px;
    text-align:center;
    min-height:64px;
    margin:6px 12px 14px;
    white-space:pre-line;
  }

  .panel{width:100%;max-width:820px;margin-top:8px}
  .panel-inner{
    background:#111a27;
    border:1px solid var(--line);
    border-radius:14px;
    padding:16px
  }
  .row{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    flex-wrap:wrap
  }
  .label{opacity:.8}
  input[type="range"]{width:100%}
  .btn{
    cursor:pointer;
    border:1px solid var(--line);
    background:#122034;
    color:#e6edf3;
    padding:10px 14px;
    border-radius:10px;
    transition:background .16s, box-shadow .16s, transform .08s;
  }
  .btn:hover{background:#162a43}
  .btn:active{transform:scale(.97)}
  .muted{opacity:.8;font-size:13px}
  .choice-row{margin-bottom:10px}
  .btn.choice{
    flex:1 1 120px;
    text-align:center;
  }
  .btn.choice.selected{
    box-shadow:0 0 0 2px var(--good) inset;
  }
  .promptText{
    margin-top:6px;
    font-size:13px;
    line-height:1.35;
  }

  /* Outcome focus */
  .outcomeWrap{
    display:none;
    width:100%;
    max-width:820px
  }
  .bigMsg{
    margin:6px 0 14px;
    padding:16px;
    text-align:center;
    line-height:1.08;
    font-size:clamp(22px,4.8vw,44px);
    font-weight:900;
    letter-spacing:.2px;
    white-space:pre-line
  }
  .bigMsg.good{color:var(--good)}
  .bigMsg.bad{color:var(--bad)}
  .outcome{
    padding:18px;
    border-radius:12px;
    border:1px solid var(--line);
    text-align:center
  }
  .goodBox{
    background:#0f1c14;
    border-color:#234333;
    color:var(--good)
  }
  .badBox{
    background:#1c0f10;
    border-color:#432326;
    color:var(--bad)
  }
  .big{
    font-size:clamp(18px,2.6vw,28px);
    font-weight:900
  }
  .center{
    display:flex;
    justify-content:center;
    gap:10px;
    margin-top:12px
  }

  /* Clue overlay */
  .flash{
    position:absolute;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
    color:#d9e6ff;
    font-weight:900;
    text-align:center;
    padding:16px;
    opacity:0;
    pointer-events:none;
    filter:blur(0)
  }
  .flash.show{
    animation:clueIn .4s ease-out forwards,
             clueHold 3.6s linear .4s forwards,
             clueOut .5s ease-in 4s forwards
  }
  @keyframes clueIn{
    0%{opacity:0;transform:scale(.85);filter:blur(2px)}
    100%{opacity:1;transform:scale(1);filter:blur(0)}
  }
  @keyframes clueHold{
    0%{opacity:1}
    100%{opacity:1}
  }
  @keyframes clueOut{
    0%{opacity:1}
    100%{opacity:0;transform:scale(1.03)}
  }
  .flashInner{
    background:rgba(7,11,16,.90);
    border:1px solid #2a7bd4;
    border-radius:16px;
    padding:18px 22px;
    font-size:clamp(18px,3.8vw,32px);
    box-shadow:0 0 0 2px rgba(42,123,212,.15) inset
  }
</style>
</head>
<body>
  <header>
    <div class="hud">
      <div class="pill"><span class="k">Day</span><span class="v" id="day">1</span></div>
      <div class="pill"><span class="k">Price</span><span class="v" id="price">$0.00002857</span></div>
      <div class="pill"><span class="k">Market Cap</span><span class="v" id="mc">$10,000</span></div>
    </div>
    <span class="brand-badge">CGT</span>
  </header>

  <main class="stage">
    <section class="card">
      <div id="flash" class="flash"><div id="flashInner" class="flashInner">Signal…</div></div>

      <h1 id="title" class="headline">Loading…</h1>
      <p id="desc" class="type"></p>

      <div id="controls" class="panel" style="opacity:0;">
        <div class="panel-inner">
          <div class="row choice-row">
            <button id="boldBtn" class="btn choice">Bold path</button>
            <button id="conservativeBtn" class="btn choice">Conservative path</button>
          </div>
          <div class="promptText">
            <div id="boldPromptText" class="muted"></div>
            <div id="conservativePromptText" class="muted" style="margin-top:4px;"></div>
          </div>

          <div id="intensityBlock" style="margin-top:12px;"></div>

          <div class="row" style="margin-top:12px">
            <button id="commit" class="btn">Resolve decision</button>
            <span class="muted">0% = no risk. Higher = bigger swings.</span>
          </div>
        </div>
      </div>

      <div id="outcomeWrap" class="outcomeWrap">
        <div id="bigMsg" class="bigMsg"></div>
        <div id="outcomeBox" class="outcome"></div>
        <div class="center">
          <button id="next" class="btn">Next day</button>
          <button id="restart" class="btn" style="display:none;">Restart</button>
        </div>
      </div>
    </section>
  </main>

  <!-- Founder scenario data (from founder-data.js in the same folder) -->
  <script src="founder-data.js"></script>

<script>
/* ========= Core state ========= */
const SUPPLY = 350_000_000;
let day = 1;
let price = 10_000 / SUPPLY;       // seed from MC / supply
let START_MC = price * SUPPLY;

function mc(){ return price * SUPPLY; }
function fmtUSD(n, d=8){
  const o = {
    minimumFractionDigits:(n<1?d:2),
    maximumFractionDigits:(n<1?d:2)
  };
  return '$'+n.toLocaleString(undefined,o);
}

/* ========= Utilities ========= */
const $ = s => document.querySelector(s);
const sleep = ms => new Promise(r=>setTimeout(r,ms));
function rand(min,max){ return Math.random()*(max-min)+min; }

/* ========= DOM ========= */
const elDay = $('#day');
const elPrice = $('#price');
const elMC = $('#mc');
const elTitle = $('#title');
const elDesc = $('#desc');
const elControls = $('#controls');
const elIntensityBlock = $('#intensityBlock');
const elCommit = $('#commit');
const elOutcomeWrap = $('#outcomeWrap');
const elBigMsg = $('#bigMsg');
const elOutcomeBox = $('#outcomeBox');
const elNext = $('#next');
const elRestart = $('#restart');
const elFlash = $('#flash');
const elFlashInner = $('#flashInner');
const elBoldBtn = $('#boldBtn');
const elConsBtn = $('#conservativeBtn');
const elBoldPromptText = $('#boldPromptText');
const elConsPromptText = $('#conservativePromptText');

let intensityValue = 0;
let locked = false;
let decision = null; // 'bold' or 'conservative'
let currentIndex = 0;

/* ========= Load Founder scenarios ========= */
let founderScenarios = (window.CGT_SCENARIOS && window.CGT_SCENARIOS.founder) || [];

// Fallback if founder-data.js missing or empty
if (!Array.isArray(founderScenarios) || founderScenarios.length === 0) {
  founderScenarios = [{
    subBand: 'F-B1-0.1',
    marketCap: '$10 K',
    focus: 'First spark',
    context: 'Barely off the ground; prototype exists, but nobody’s watching.',
    boldPrompt: 'Launch MVP to public now — even if half-broken.',
    conservativePrompt: 'Keep it closed, polish in silence.',
    impactSummary: 'Bold → sudden small hype wave but fragile trust; Conservative → slower start but stable baseline.',
    tone: 'risky',
    outcomeA: 'Early adopters rally behind the MVP, posting screenshots and feedback that spark a viral micro-wave of credibility.',
    outcomeB: 'Launch exposes half-finished systems; bugs and confusion dominate the narrative, causing early trust erosion.',
    outcomeC: 'A few testers privately confirm the build’s strength; quiet progress builds word-of-mouth trust.',
    outcomeD: 'Delays frustrate insiders who drift away, leaving the project isolated before momentum forms.'
  }];
}

/* ========= HUD ========= */
function updateHUD(){
  elDay.textContent = String(day);
  elPrice.textContent = fmtUSD(price,8);
  elMC.textContent = fmtUSD(mc());
}

/* ========= Typewriter ========= */
async function typewrite(el, text, speed=35){
  el.textContent = '';
  for(let i=0;i<text.length;i++){
    el.textContent += text[i];
    await sleep(speed);
  }
}

/* ========= Clue overlay (optional flavour) ========= */
async function maybeShowClueBlocking(){
  const p = rand(1/7, 1/4); // ~14–25%
  if (Math.random() < p){
    elFlashInner.textContent = [
      "Community buzz rising",
      "Regulatory fog ahead",
      "Infra feels solid",
      "Liquidity thin",
      "Streamer whispers…"
    ][Math.floor(Math.random()*5)] || "Signal incoming…";
    elFlash.classList.add('show');
    await sleep(4600);
    elFlash.classList.remove('show');
    await sleep(700);
  }
}

/* ========= Intensity slider ========= */
function renderIntensity(){
  elIntensityBlock.innerHTML = '';

  const label = document.createElement('div');
  label.className = 'label';
  label.textContent = 'Risk intensity';

  const row = document.createElement('div');
  row.className = 'row';

  const left = document.createElement('div');
  left.style.fontWeight = '900';
  left.style.fontSize = '18px';

  const right = document.createElement('div');
  right.style.flex = '1';

  const input = document.createElement('input');
  input.type = 'range';
  input.min = 0;
  input.max = 100;
  input.step = 5;
  intensityValue = 0;
  input.value = intensityValue;

  const setLabel = () => {
    left.textContent = intensityValue + '%';
  };
  setLabel();

  input.oninput = e => {
    intensityValue = Number(e.target.value) || 0;
    setLabel();
  };

  right.appendChild(input);
  row.appendChild(left);
  row.appendChild(right);
  elIntensityBlock.appendChild(label);
  elIntensityBlock.appendChild(row);
}

/* ========= Decision helpers ========= */
function clearDecisionUI(){
  decision = null;
  elBoldBtn.classList.remove('selected');
  elConsBtn.classList.remove('selected');
}

function setDecision(which){
  decision = which;
  if (which === 'bold'){
    elBoldBtn.classList.add('selected');
    elConsBtn.classList.remove('selected');
  } else if (which === 'conservative'){
    elConsBtn.classList.add('selected');
    elBoldBtn.classList.remove('selected');
  }
}

/* ========= New scenario ========= */
async function newScenario(){
  locked = false;
  clearDecisionUI();

  elTitle.textContent = 'Loading…';
  elDesc.textContent = '';
  elControls.style.opacity = 0;
  elOutcomeWrap.style.display = 'none';
  elBigMsg.textContent = '';
  elOutcomeBox.className = 'outcome';

  // prevent index overflow
  if (currentIndex >= founderScenarios.length){
    currentIndex = founderScenarios.length - 1;
  }
  const s = founderScenarios[currentIndex];

  await maybeShowClueBlocking();

  // reset title animation
  elTitle.style.animation = 'none';
  void elTitle.offsetWidth;
  elTitle.style.animation = null;

  const titleText = s.subBand ? `${s.subBand} · ${s.focus}` : (s.focus || 'Founder Scenario');
  elTitle.textContent = titleText;

  // short delay to let headline slide
  await sleep(1600 + 300);

  // prompts + slider
  elBoldPromptText.textContent = 'Bold: ' + (s.boldPrompt || '');
  elConsPromptText.textContent = 'Conservative: ' + (s.conservativePrompt || '');
  renderIntensity();

  // description = context + impact summary
  const introText = (s.context || '') + '\n\n' + (s.impactSummary || '');
  await typewrite(elDesc, introText, 30);

  await sleep(400);
  elControls.style.opacity = 1;
}

/* ========= Price movement & outcomes ========= */

function computeMultiplier(isFavourable, decisionSide){
  // base bands
  let upMin = 0.04, upMax = 0.20;
  let downMin = -0.04, downMax = -0.20;

  if (decisionSide === 'bold'){
    upMax = 0.35;
    downMax = -0.28;
  } else {
    upMax = 0.18;
    downMax = -0.16;
  }

  const norm = Math.max(0, Math.min(1, intensityValue / 100));

  if (isFavourable){
    const raw = rand(upMin, upMax);
    const scaled = raw * (0.3 + 0.7*norm); // slider controls 30–100% of move
    return 1 + scaled;
  } else {
    const raw = rand(downMin, downMax); // negative
    const scaled = raw * (0.3 + 0.7*norm);
    return 1 + scaled;
  }
}

function resolveDecision(){
  if (locked) return;
  const s = founderScenarios[currentIndex];
  if (!s) return;

  if (!decision){
    alert('Choose Bold or Conservative first.');
    return;
  }

  // 60 / 40 bias
  const isFavourable = Math.random() < 0.6;

  let outcomeText = '';
  if (decision === 'bold'){
    outcomeText = isFavourable ? (s.outcomeA || '') : (s.outcomeB || '');
  } else {
    outcomeText = isFavourable ? (s.outcomeC || '') : (s.outcomeD || '');
  }

  const mult = computeMultiplier(isFavourable, decision);
  showOutcome(isFavourable, mult, outcomeText, s);
  locked = true;
}

function showOutcome(isFavourable, mult, text, scenario){
  const oldPrice = price;
  price = price * mult;

  elTitle.textContent = '';
  elDesc.textContent = '';
  elControls.style.opacity = 0;

  elBigMsg.className = 'bigMsg ' + (isFavourable ? 'good' : 'bad');
  const line1 = decision === 'bold' ? 'Bold move' : 'Conservative move';
  const line2 = isFavourable ? 'Favourable outcome' : 'Unfavourable outcome';
  elBigMsg.textContent = line1 + '\n' + line2;

  elOutcomeWrap.style.display = 'block';
  const cls = isFavourable ? 'goodBox' : 'badBox';
  elOutcomeBox.className = 'outcome ' + cls;

  const pct = ((mult-1)*100).toFixed(1);
  const priceLine = `Price: <b>${fmtUSD(oldPrice,8)}</b> → <b>${fmtUSD(price,8)}</b>`;
  const mcLine = `Market Cap: <b>${fmtUSD(oldPrice*SUPPLY)}</b> → <b>${fmtUSD(mc())}</b>`;
  const scenarioLine = scenario ? `<div class="muted" style="margin-top:10px;">${scenario.focus || ''}</div>` : '';

  elOutcomeBox.innerHTML = `
    <div class="big">${isFavourable ? 'Gain' : 'Loss'} &nbsp; (${pct>0?'+':''}${pct}%)</div>
    <div>${priceLine}</div>
    <div class="muted">${mcLine}</div>
    <div style="margin-top:10px;">${text}</div>
    ${scenarioLine}
  `;

  if (price <= 0.0000000001){
    elNext.style.display = 'none';
    elRestart.style.display = 'inline-block';
  } else {
    elNext.style.display = 'inline-block';
    elRestart.style.display = 'none';
  }

  updateHUD();
}

/* ========= Flow ========= */
function nextDay(){
  if (price <= 0.0000000001) return;

  day += 1;
  if (currentIndex < founderScenarios.length - 1){
    currentIndex += 1;
  } else {
    // stay on last scenario; you could also loop back if you prefer
    currentIndex = founderScenarios.length - 1;
  }
  updateHUD();
  newScenario();
}

function restartGame(){
  day = 1;
  price = 10_000 / SUPPLY;
  START_MC = price * SUPPLY;
  currentIndex = 0;
  updateHUD();
  newScenario();
}

/* ========= Init ========= */
(function init(){
  updateHUD();
  elBoldBtn.addEventListener('click', ()=>setDecision('bold'));
  elConsBtn.addEventListener('click', ()=>setDecision('conservative'));
  elCommit.addEventListener('click', resolveDecision);
  elNext.addEventListener('click', nextDay);
  elRestart.addEventListener('click', restartGame);
  newScenario();
})();
</script>
</body>
</html>
