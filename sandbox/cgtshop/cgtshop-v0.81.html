<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CGT Shop v0.81</title>
<style>
  :root{
    --bg:#0a0f14;
    --surface:#0f1620;
    --ink:#e6edf3;
    --ink-dim:#9fb0c2;
    --line:#223041;
    --good:#7cf08a;
    --bad:#ff8a8a;
    --hint:#c8d6e5;
    --bold-track:linear-gradient(to right, rgba(124,240,138,.6), rgba(124,240,138,0));
    --cons-track:linear-gradient(to left, rgba(135,180,255,.6), rgba(135,180,255,0));
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    background:var(--bg);
    color:var(--ink);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif
  }

  /* Header */
  header{
    position:sticky;
    top:0;
    z-index:10;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    padding:12px 16px;
    background:rgba(15,22,32,.78);
    backdrop-filter:blur(8px);
    border-bottom:1px solid var(--line)
  }
  .hud{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  .pill{
    padding:6px 10px;
    border:1px solid var(--line);
    border-radius:999px;
    white-space:nowrap
  }
  .k{opacity:.7;margin-right:6px}
  .v{font-weight:700}
  .brand-badge{
    display:inline-flex;
    align-items:center;
    justify-content:center;
    height:42px;
    padding:0 18px;
    border-radius:999px;
    border:1px solid var(--line);
    background:#101a24;
    color:#a7c7ff;
    font-weight:900;
    letter-spacing:.6px;
    font-size:18px;
    box-shadow:0 0 0 2px rgba(42,123,212,.08) inset
  }

  /* Stage */
  .stage{
    min-height:calc(100% - 70px);
    display:flex;
    align-items:center;
    justify-content:center;
    padding:18px
  }
  .card{
    width:min(980px,100%);
    min-height:72vh;
    background:linear-gradient(180deg,#0f1620 0%,#0c121a 100%);
    border:1px solid var(--line);
    border-radius:18px;
    padding:20px 18px;
    position:relative;
    overflow:hidden;
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center
  }

  /* Cinematic headline */
  .headline{
    font-size:clamp(22px,4.4vw,42px);
    font-weight:900;
    letter-spacing:.3px;
    text-align:center;
    margin:0 10px 8px;
    opacity:0;
    transform:translateX(40vw);
    animation:slideAcross 1.6s ease-out forwards
  }
  @keyframes slideAcross{
    0%{opacity:0;transform:translateX(40vw)}
    15%{opacity:1}
    85%{opacity:1;transform:translateX(-40vw)}
    100%{opacity:1;transform:translateX(0)}
  }
  .type{
    color:var(--ink-dim);
    max-width:820px;
    text-align:center;
    min-height:64px;
    margin:6px 12px 14px;
    white-space:pre-line;
  }

  .panel{width:100%;max-width:820px;margin-top:8px}
  .panel-inner{
    background:#111a27;
    border:1px solid var(--line);
    border-radius:14px;
    padding:16px
  }
  .row{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    flex-wrap:wrap
  }
  .label{opacity:.8;font-size:13px}
  .btn{
    cursor:pointer;
    border:1px solid var(--line);
    background:#122034;
    color:#e6edf3;
    padding:10px 14px;
    border-radius:10px;
    transition:background .16s, box-shadow .16s, transform .08s;
  }
  .btn:hover{background:#162a43}
  .btn:active{transform:scale(.97)}
  .muted{opacity:.8;font-size:13px}
  .choice-row{margin-bottom:10px}
  .btn.choice{
    flex:1 1 120px;
    text-align:center;
    font-weight:700;
  }
  .btn.choice.selected{
    box-shadow:0 0 0 2px var(--good) inset;
  }

  /* Slider */
  #sliderBlock{
    margin-top:12px;
  }
  .slider-label-row{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:8px;
    margin-bottom:4px;
  }
  .slider-value{
    font-weight:700;
    font-size:14px;
  }
  .sliderWrap{
    width:100%;
  }
  input[type="range"]{
    width:100%;
    -webkit-appearance:none;
    height:6px;
    border-radius:999px;
    background:#182333;
    outline:none;
    margin:8px 0;
  }
  input[type="range"]::-webkit-slider-thumb{
    -webkit-appearance:none;
    appearance:none;
    width:18px;
    height:18px;
    border-radius:50%;
    background:#ffffff;
    border:2px solid #2a7bd4;
    box-shadow:0 0 12px rgba(42,123,212,.6);
    cursor:pointer;
    margin-top:-6px;
  }
  input[type="range"]::-moz-range-thumb{
    width:18px;
    height:18px;
    border-radius:50%;
    background:#ffffff;
    border:2px solid #2a7bd4;
    box-shadow:0 0 12px rgba(42,123,212,.6);
    cursor:pointer;
  }
  input[type="range"]::-webkit-slider-runnable-track{
    height:6px;
    border-radius:999px;
    background:#182333;
  }
  input[type="range"]::-moz-range-track{
    height:6px;
    border-radius:999px;
    background:#182333;
  }

  .card.bold-mode input[type="range"]::-webkit-slider-runnable-track{
    background:var(--bold-track);
  }
  .card.bold-mode input[type="range"]::-moz-range-track{
    background:var(--bold-track);
  }
  .card.cons-mode input[type="range"]::-webkit-slider-runnable-track{
    background:var(--cons-track);
  }
  .card.cons-mode input[type="range"]::-moz-range-track{
    background:var(--cons-track);
  }

  /* Outcome focus */
  .outcomeWrap{
    display:none;
    width:100%;
    max-width:820px
  }
  .bigMsg{
    margin:6px 0 14px;
    padding:16px;
    text-align:center;
    line-height:1.08;
    font-size:clamp(22px,4.8vw,44px);
    font-weight:900;
    letter-spacing:.2px;
    white-space:pre-line
  }
  .bigMsg.good{color:var(--good)}
  .bigMsg.bad{color:var(--bad)}
  .outcome{
    padding:18px;
    border-radius:12px;
    border:1px solid var(--line);
    text-align:center
  }
  .goodBox{
    background:#0f1c14;
    border-color:#234333;
    color:var(--good)
  }
  .badBox{
    background:#1c0f10;
    border-color:#432326;
    color:var(--bad)
  }
  .big{
    font-size:clamp(18px,2.6vw,28px);
    font-weight:900
  }
  .center{
    display:flex;
    justify-content:center;
    gap:10px;
    margin-top:12px
  }

  /* Clue overlay */
  .flash{
    position:absolute;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
    color:#d9e6ff;
    font-weight:900;
    text-align:center;
    padding:16px;
    opacity:0;
    pointer-events:none;
    filter:blur(0)
  }
  .flash.show{
    animation:clueIn .4s ease-out forwards,
             clueHold 3.6s linear .4s forwards,
             clueOut .5s ease-in 4s forwards
  }
  @keyframes clueIn{
    0%{opacity:0;transform:scale(.85);filter:blur(2px)}
    100%{opacity:1;transform:scale(1);filter:blur(0)}
  }
  @keyframes clueHold{
    0%{opacity:1}
    100%{opacity:1}
  }
  @keyframes clueOut{
    0%{opacity:1}
    100%{opacity:0;transform:scale(1.03)}
  }
  .flashInner{
    background:rgba(7,11,16,.90);
    border:1px solid #2a7bd4;
    border-radius:16px;
    padding:18px 22px;
    font-size:clamp(18px,3.8vw,32px);
    box-shadow:0 0 0 2px rgba(42,123,212,.15) inset
  }
</style>
</head>
<body>
  <header>
    <div class="hud">
      <div class="pill"><span class="k">Day</span><span class="v" id="day">1</span></div>
      <div class="pill"><span class="k">Price</span><span class="v" id="price">$0.00002857</span></div>
      <div class="pill"><span class="k">Market Cap</span><span class="v" id="mc">$10,000</span></div>
    </div>
    <span class="brand-badge">CGT</span>
  </header>

  <main class="stage">
    <section class="card" id="card">
      <div id="flash" class="flash"><div id="flashInner" class="flashInner">Signal…</div></div>

      <h1 id="title" class="headline">Loading…</h1>
      <p id="desc" class="type"></p>

      <div id="controls" class="panel" style="opacity:0;">
        <div class="panel-inner">
          <div class="row choice-row">
            <button id="boldBtn" class="btn choice">Bold path</button>
            <button id="consBtn" class="btn choice">Conservative path</button>
          </div>

          <div id="sliderBlock" style="display:none;"></div>

          <div class="row" style="margin-top:12px">
            <button id="commit" class="btn">Commit decision</button>
            <span class="muted">Set your multiplier, then commit the move.</span>
          </div>
        </div>
      </div>

      <div id="outcomeWrap" class="outcomeWrap">
        <div id="bigMsg" class="bigMsg"></div>
        <div id="outcomeBox" class="outcome"></div>
        <div class="center">
          <button id="next" class="btn">Next day</button>
          <button id="restart" class="btn" style="display:none;">Restart</button>
        </div>
      </div>
    </section>
  </main>

  <!-- Founder scenario data -->
  <script src="founder-data.js"></script>

<script>
/* ========= Core state ========= */
const SUPPLY = 350_000_000;
let day = 1;
let price = 10_000 / SUPPLY;
let START_MC = price * SUPPLY;

function mc(){ return price * SUPPLY; }
function fmtUSD(n, d=8){
  const o = {
    minimumFractionDigits:(n<1?d:2),
    maximumFractionDigits:(n<1?d:2)
  };
  return '$'+n.toLocaleString(undefined,o);
}

/* ========= Utilities ========= */
const $ = s => document.querySelector(s);
const sleep = ms => new Promise(r=>setTimeout(r,ms));
function rand(min,max){ return Math.random()*(max-min)+min; }

/* ========= DOM ========= */
const elDay = $('#day');
const elPrice = $('#price');
const elMC = $('#mc');
const elTitle = $('#title');
const elDesc = $('#desc');
const elControls = $('#controls');
const elOutcomeWrap = $('#outcomeWrap');
const elBigMsg = $('#bigMsg');
const elOutcomeBox = $('#outcomeBox');
const elNext = $('#next');
const elRestart = $('#restart');
const elFlash = $('#flash');
const elFlashInner = $('#flashInner');
const elBoldBtn = $('#boldBtn');
const elConsBtn = $('#consBtn');
const elSliderBlock = $('#sliderBlock');
const elCommit = $('#commit');
const elCard = $('#card');

let founderScenarios = (window.CGT_SCENARIOS && window.CGT_SCENARIOS.founder) || [];

// fallback if needed
if (!Array.isArray(founderScenarios) || founderScenarios.length === 0){
  founderScenarios = [{
    subBand:'F-B1-0.1',
    marketCap:'$10 K',
    focus:'First spark',
    context:'Barely off the ground; prototype exists, but nobody’s watching.',
    boldPrompt:'Launch MVP to public now — even if half-broken.',
    conservativePrompt:'Keep it closed, polish in silence.',
    impactSummary:'',
    tone:'risky',
    outcomeA:'Early adopters rally behind the MVP, posting screenshots and feedback that spark a viral micro-wave of credibility.',
    outcomeB:'Launch exposes half-finished systems; bugs and confusion dominate the narrative, causing early trust erosion.',
    outcomeC:'A few testers privately confirm the build’s strength; quiet progress builds word-of-mouth trust.',
    outcomeD:'Delays frustrate insiders who drift away, leaving the project isolated before momentum forms.'
  }];
}

let currentIndex = 0;
let decision = null;           // 'bold' or 'conservative'
let sliderInput = null;
let sliderMin = 0.1;
let sliderMax = 3.0;
let locked = false;
let hasOutcomeShown = false;

/* ========= HUD ========= */
function updateHUD(){
  elDay.textContent = String(day);
  elPrice.textContent = fmtUSD(price,8);
  elMC.textContent = fmtUSD(mc());
}

/* ========= Typewriter ========= */
async function typewrite(el, text, speed=30){
  el.textContent = '';
  for(let i=0;i<text.length;i++){
    el.textContent += text[i];
    await sleep(speed);
  }
}

/* ========= Clue overlay ========= */
async function maybeShowClueBlocking(){
  const p = rand(1/7, 1/4);
  if (Math.random() < p){
    const msgs = [
      "Community buzz rising",
      "Regulatory fog ahead",
      "Infra feels solid",
      "Liquidity thin",
      "Streamer whispers…"
    ];
    elFlashInner.textContent = msgs[Math.floor(Math.random()*msgs.length)] || "Signal incoming…";
    elFlash.classList.add('show');
    await sleep(4600);
    elFlash.classList.remove('show');
    await sleep(700);
  }
}

/* ========= Band → slider range ========= */
function getBandRange(subBand){
  const parts = (subBand || '').split('-'); // e.g. F-B1-0.1
  const bandCode = parts[1] || '';
  let max = 3.0;
  if (bandCode === 'B1') max = 5.0;
  else if (bandCode === 'B2') max = 4.0;
  else if (bandCode === 'B3') max = 3.0;
  else if (bandCode === 'B4') max = 2.0;
  else if (bandCode === 'B5') max = 1.0;
  return {min:0.1, max, step:0.1};
}

/* ========= Slider rendering ========= */
function renderSlider(range){
  sliderMin = range.min;
  sliderMax = range.max;

  elSliderBlock.innerHTML = '';

  const labelRow = document.createElement('div');
  labelRow.className = 'slider-label-row';

  const lbl = document.createElement('div');
  lbl.className = 'label';
  lbl.textContent = 'Risk multiplier';

  const val = document.createElement('div');
  val.className = 'slider-value';
  val.id = 'sliderValue';

  labelRow.appendChild(lbl);
  labelRow.appendChild(val);

  const wrap = document.createElement('div');
  wrap.className = 'sliderWrap';

  const input = document.createElement('input');
  input.type = 'range';
  input.min = sliderMin;
  input.max = sliderMax;
  input.step = range.step;
  input.value = sliderMin;

  const updateValueLabel = () => {
    const v = parseFloat(input.value || sliderMin);
    val.textContent = v.toFixed(1) + '×';
  };
  input.addEventListener('input', updateValueLabel);

  updateValueLabel();
  wrap.appendChild(input);

  elSliderBlock.appendChild(labelRow);
  elSliderBlock.appendChild(wrap);

  sliderInput = input;
  elSliderBlock.style.display = 'block';
}

/* ========= Decision helpers ========= */
function clearDecisionUI(){
  decision = null;
  elBoldBtn.classList.remove('selected');
  elConsBtn.classList.remove('selected');
  elSliderBlock.style.display = 'none';
  elCard.classList.remove('bold-mode','cons-mode');
}

function setDecision(which, range){
  decision = which;
  if (which === 'bold'){
    elBoldBtn.classList.add('selected');
    elConsBtn.classList.remove('selected');
    elCard.classList.add('bold-mode');
    elCard.classList.remove('cons-mode');
  } else {
    elConsBtn.classList.add('selected');
    elBoldBtn.classList.remove('selected');
    elCard.classList.add('cons-mode');
    elCard.classList.remove('bold-mode');
  }
  renderSlider(range);
}

/* ========= New scenario ========= */
async function newScenario(){
  locked = false;
  hasOutcomeShown = false;
  clearDecisionUI();

  elOutcomeWrap.style.display = 'none';
  elTitle.textContent = 'Loading…';
  elDesc.textContent = '';
  elControls.style.opacity = 0;

  if (currentIndex >= founderScenarios.length){
    currentIndex = founderScenarios.length - 1;
  }
  const s = founderScenarios[currentIndex];

  await maybeShowClueBlocking();

  // reset title animation
  elTitle.style.animation = 'none';
  void elTitle.offsetWidth;
  elTitle.style.animation = null;

  const titleText = s.subBand ? `${s.subBand} · ${s.focus}` : (s.focus || 'Founder Scenario');
  elTitle.textContent = titleText;

  await sleep(1600 + 300);

  const bandRange = getBandRange(s.subBand);
  // slider only appears after decision, but we keep range ready
  elSliderBlock.style.display = 'none';

  const intro = (s.context || '') + '\n\n' +
    `Tone: ${s.tone || 'neutral'} · Ref MC: ${s.marketCap || ''}`;

  await typewrite(elDesc, intro, 28);
  await sleep(300);
  elControls.style.opacity = 1;

  // attach decision handlers per-scenario so they always use correct bandRange
  elBoldBtn.onclick = () => setDecision('bold', bandRange);
  elConsBtn.onclick = () => setDecision('conservative', bandRange);
}

/* ========= Outcome logic ========= */
function resolveDecision(){
  if (locked) return;
  const s = founderScenarios[currentIndex];
  if (!s) return;

  if (!decision){
    alert('Choose Bold or Conservative first.');
    return;
  }
  if (!sliderInput){
    alert('Set your multiplier before committing.');
    return;
  }

  const sliderMult = Math.max(sliderMin, Math.min(sliderMax, parseFloat(sliderInput.value || sliderMin)));

  // 60 / 40 bias
  const isFavourable = Math.random() < 0.6;

  let outcomeText = '';
  if (decision === 'bold'){
    outcomeText = isFavourable ? (s.outcomeA || '') : (s.outcomeB || '');
  } else {
    outcomeText = isFavourable ? (s.outcomeC || '') : (s.outcomeD || '');
  }

  applyOutcome(isFavourable, sliderMult, outcomeText, s);
  locked = true;
}

function applyOutcome(isFavourable, mult, text, scenario){
  const oldMC = mc();
  let newMC;

  if (isFavourable){
    newMC = oldMC * mult;
  } else {
    // avoid divide-by-zero or insane collapse
    const safeMult = Math.max(mult, 0.1);
    newMC = oldMC / safeMult;
  }

  // set global price from new MC
  price = newMC / SUPPLY;

  showOutcome(isFavourable, mult, text, scenario, oldMC, newMC);
}

function showOutcome(isFavourable, mult, text, scenario, oldMC, newMC){
  hasOutcomeShown = true;

  elTitle.textContent = '';
  elDesc.textContent = '';
  elControls.style.opacity = 0;

  elBigMsg.className = 'bigMsg ' + (isFavourable ? 'good' : 'bad');
  const line1 = decision === 'bold' ? 'Bold move' : 'Conservative move';
  const line2 = isFavourable ? 'Favourable outcome' : 'Unfavourable outcome';
  elBigMsg.textContent = line1 + '\n' + line2;

  elOutcomeWrap.style.display = 'block';
  const cls = isFavourable ? 'goodBox' : 'badBox';
  elOutcomeBox.className = 'outcome ' + cls;

  const mcChangePct = ((newMC - oldMC) / oldMC) * 100;
  const pctStr = (mcChangePct>=0?'+':'') + mcChangePct.toFixed(1) + '%';

  const priceLine = `Price: <b>${fmtUSD(oldMC/SUPPLY,8)}</b> → <b>${fmtUSD(price,8)}</b>`;
  const mcLine = `Market Cap: <b>${fmtUSD(oldMC)}</b> → <b>${fmtUSD(newMC)}</b>`;
  const focusLine = scenario ? `<div class="muted" style="margin-top:10px;">${scenario.focus || ''}</div>` : '';

  elOutcomeBox.innerHTML = `
    <div class="big">${isFavourable ? 'Gain' : 'Loss'} &nbsp; (${pctStr})</div>
    <div>${priceLine}</div>
    <div class="muted">${mcLine}</div>
    <div style="margin-top:10px;">${text}</div>
    ${focusLine}
  `;

  if (price <= 0){
    elNext.style.display = 'none';
    elRestart.style.display = 'inline-block';
  } else {
    elNext.style.display = 'inline-block';
    elRestart.style.display = 'none';
  }

  updateHUD();
}

/* ========= Flow ========= */
function nextDay(){
  if (price <= 0) return;
  day += 1;
  if (currentIndex < founderScenarios.length - 1){
    currentIndex += 1;
  } else {
    currentIndex = founderScenarios.length - 1;
  }
  updateHUD();
  newScenario();
}

function restartGame(){
  day = 1;
  price = 10_000 / SUPPLY;
  START_MC = price * SUPPLY;
  currentIndex = 0;
  updateHUD();
  newScenario();
}

/* ========= Init ========= */
(function init(){
  updateHUD();
  elCommit.addEventListener('click', resolveDecision);
  elNext.addEventListener('click', nextDay);
  elRestart.addEventListener('click', restartGame);

  // Tap anywhere on card (not controls) to go next day after outcome
  elCard.addEventListener('click', e => {
    if (!hasOutcomeShown) return;
    if (e.target.closest('button') || e.target.closest('input')) return;
    nextDay();
  });

  newScenario();
})();
</script>
</body>
</html>
