<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CGT Shop — Playable MVP</title>
<style>
  :root{
    --bg:#0a0f14; --surface:#0f1620; --ink:#e6edf3; --ink-dim:#9fb0c2; --line:#223041;
    --good:#7cf08a; --bad:#ff8a8a; --hint:#c8d6e5; --accent:#2a7bd4;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}
  /* Header */
  header{
    position:sticky; top:0; z-index:10;
    display:flex; align-items:center; justify-content:space-between;
    gap:12px; padding:12px 16px;
    background:rgba(15,22,32,.75); backdrop-filter:blur(8px); border-bottom:1px solid var(--line);
  }
  .hud{display:flex; gap:8px; flex-wrap:wrap; align-items:center}
  .pill{padding:6px 10px; border:1px solid var(--line); border-radius:999px; white-space:nowrap}
  .k{opacity:.7; margin-right:6px}
  .v{font-weight:700}
  .brand{display:flex; align-items:center; gap:8px}
  .brand-badge{
    display:inline-flex; align-items:center; justify-content:center;
    height:28px; padding:0 12px; border-radius:999px; border:1px solid var(--line);
    background:#111a27; color:#a7c7ff; font-weight:800; letter-spacing:.4px
  }
  /* Stage */
  .stage{min-height:calc(100% - 64px); display:flex; align-items:center; justify-content:center; padding:18px}
  .card{
    width:min(980px,100%); min-height:72vh;
    background:linear-gradient(180deg,#0f1620 0%,#0c121a 100%);
    border:1px solid var(--line); border-radius:18px; padding:20px 18px;
    position:relative; overflow:hidden; display:flex; flex-direction:column; justify-content:center; align-items:center;
  }
  /* Cinematic flows */
  .headline{
    font-size:clamp(22px,4.2vw,40px); font-weight:900; letter-spacing:.3px; text-align:center; margin:0 10px 8px;
    opacity:0; transform:translateX(40vw);
    animation:slideAcross 1.6s ease-out forwards;
  }
  @keyframes slideAcross{
    0%{opacity:0; transform:translateX(40vw)}
    15%{opacity:1}
    85%{opacity:1; transform:translateX(-40vw)}
    100%{opacity:1; transform:translateX(0)}
  }
  .type{color:var(--ink-dim); max-width:820px; text-align:center; min-height:64px; margin:6px 12px 14px}
  .panel{width:100%; max-width:820px; margin-top:8px}
  .panel-inner{background:#111a27; border:1px solid var(--line); border-radius:14px; padding:16px}
  .row{display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap}
  .label{opacity:.8}
  input[type="range"]{width:100%}
  .btn{cursor:pointer; border:1px solid var(--line); background:#122034; color:var(--ink); padding:10px 14px; border-radius:10px}
  .btn:hover{background:#162a43}
  .muted{opacity:.8}
  .outcome{margin-top:16px; padding:20px; border-radius:12px; border:1px solid var(--line); text-align:center}
  .good{background:#0f1c14; border-color:#234333; color:var(--good)}
  .bad{background:#1c0f10; border-color:#432326; color:var(--bad)}
  .big{font-size:clamp(18px,2.6vw,28px); font-weight:900}
  .center{display:flex; justify-content:center; gap:10px; margin-top:12px}
  /* Clue flash overlay */
  .flash{
    position:absolute; inset:0; background:rgba(7,11,16,.85);
    display:flex; align-items:center; justify-content:center;
    color:#d9e6ff; font-weight:900; font-size:clamp(20px,3.8vw,36px);
    text-align:center; padding:16px; opacity:0; pointer-events:none;
  }
  .flash.show{opacity:1; animation:flashIn .85s ease-out forwards}
  @keyframes flashIn{
    0%{opacity:0} 20%{opacity:1} 80%{opacity:1} 100%{opacity:0}
  }
</style>
</head>
<body>
  <header>
    <div class="hud">
      <div class="pill"><span class="k">Day</span><span class="v" id="day">1</span></div>
      <div class="pill"><span class="k">Price</span><span class="v" id="price">$0.00002857</span></div>
      <div class="pill"><span class="k">Market Cap</span><span class="v" id="mc">$10,000</span></div>
    </div>
    <div class="brand">
      <span class="brand-badge">CGT</span>
    </div>
  </header>

  <main class="stage">
    <section class="card">
      <div id="flash" class="flash">Signal incoming…</div>

      <h1 id="title" class="headline">Loading…</h1>
      <p id="desc" class="type"></p>

      <div id="controls" class="panel" style="opacity:0;">
        <div class="panel-inner">
          <div id="intensityBlock"></div>
          <div class="row" style="margin-top:12px">
            <button id="commit" class="btn">Commit</button>
            <span class="muted">0% = no risk. Higher = bigger swings.</span>
          </div>
        </div>
      </div>

      <div id="reveal" class="panel" style="display:none;">
        <div id="outcomeBox" class="outcome"></div>
        <div class="center">
          <button id="next" class="btn">Next day</button>
          <button id="restart" class="btn" style="display:none;">Restart</button>
        </div>
      </div>
    </section>
  </main>

<script>
/* ====== Core State ====== */
const SUPPLY = 350_000_000;
let day = 1;
let price = 10_000 / SUPPLY; // seeded from MC / supply
function mc(){ return price * SUPPLY; }
function fmtUSD(n, d=8){
  const opts = {minimumFractionDigits:(n<1? d:2), maximumFractionDigits:(n<1? d:2)};
  return '$' + n.toLocaleString(undefined, opts);
}

/* ====== Scenarios ======
   Each scenario sets an intensity domain (quantity or %),
   and weighted multiplier buckets that apply to PRICE directly.
   volScale amplifies extremes with higher intensity.
*/
const SCENES = [
  {
    id:"creators-launch",
    title:"3rd-Party Creators — New GQTs Flood In",
    text:"Creators tee up a wave of GQTs. If the feed catches, demand rips; if timing clashes, listings sink.",
    intensity:{type:"quantity", label:"How many GQTs launch today?", min:1000, max:100000, step:1000, unit:"GQTs"},
    outcomes:[
      {label:"Ignored by feed", mult:[0.20,0.55], weight:22},
      {label:"Muted interest",  mult:[0.60,0.95], weight:33},
      {label:"Solid traction",  mult:[1.12,1.85], weight:35},
      {label:"Explosive hype",  mult:[2.00,3.60], weight:10}
    ],
    hints:["Feed activity looks hot","Competing events rumoured","No clear signals"],
    volScale:0.65
  },
  {
    id:"players-weekend",
    title:"Players — Weekend Tournament Wave",
    text:"Community organisers rally players. If streamers pick it up, wallets surge; if overshadowed, eyes drift.",
    intensity:{type:"quantity", label:"How many weekend events?", min:10, max:800, step:10, unit:"events"},
    outcomes:[
      {label:"Overshadowed", mult:[0.30,0.75], weight:25},
      {label:"Steady flow",  mult:[1.08,1.40], weight:50},
      {label:"Breakout run", mult:[1.80,3.00], weight:25}
    ],
    hints:["Noise rising","Big streamer may join","No signals"],
    volScale:0.55
  },
  {
    id:"dev-stability",
    title:"Core Devs — Stability Release",
    text:"A minor stability upgrade lands. Clean release boosts confidence; a bug flips sentiment.",
    intensity:{type:"percent", label:"How bold is rollout/testing?", min:0, max:100, step:5, unit:"%"},
    outcomes:[
      {label:"Quietly reassuring", mult:[1.05,1.25], weight:55},
      {label:"Neutral day",       mult:[0.95,1.05], weight:35},
      {label:"Bug backlash",     mult:[0.40,0.85], weight:10}
    ],
    hints:["Infra feels solid","Code freeze jitters","No signals"],
    volScale:0.35
  },
  {
    id:"reg-fog",
    title:"Regulatory Fog — Rumour Mill",
    text:"Sector-wide review whispers. Could blow over or spark a risk-off slide. Bold comms multiplies both outcomes.",
    intensity:{type:"percent", label:"How bold is comms posture?", min:0, max:100, step:5, unit:"%"},
    outcomes:[
      {label:"Flash panic",  mult:[0.10,0.50], weight:15},
      {label:"Caution day",  mult:[0.70,0.98], weight:50},
      {label:"False alarm",  mult:[1.00,1.15], weight:25},
      {label:"Counter-rally",mult:[1.30,2.20], weight:10}
    ],
    hints:["Regulatory fog ahead","Industry quiet","No signals"],
    volScale:0.75
  }
];

/* ====== Utilities ====== */
const $ = sel => document.querySelector(sel);
function choose(arr){ return arr[Math.floor(Math.random()*arr.length)] }
function pickWeighted(arr){
  const total = arr.reduce((s,o)=>s+o.weight,0);
  let r = Math.random()*total;
  for(const o of arr){ if((r-=o.weight)<=0) return o; }
  return arr[0];
}
function rand(min,max){ return Math.random()*(max-min)+min; }

/* ====== DOM Refs ====== */
const elDay = $('#day'), elPrice = $('#price'), elMC = $('#mc');
const elTitle = $('#title'), elDesc = $('#desc'), elControls = $('#controls');
const elIntensityBlock = $('#intensityBlock'), elCommit = $('#commit');
const elReveal = $('#reveal'), elOutcomeBox = $('#outcomeBox'), elNext = $('#next'), elRestart = $('#restart');
const elFlash = $('#flash');

let scene = null;
let intensityValue = 0;
let locked = false;

/* ====== HUD ====== */
function updateHUD(){
  elDay.textContent = day.toString();
  elPrice.textContent = fmtUSD(price, 8);
  elMC.textContent = fmtUSD(mc());
}

/* ====== Typewriter ====== */
async function typewrite(el, text, speed=14){
  el.textContent = '';
  for(let i=0;i<text.length;i++){
    el.textContent += text[i];
    await new Promise(r=>setTimeout(r, speed));
  }
}

/* ====== Clue Flash (random turns only) ====== */
function maybeFlashClue(){
  // ~45% of days display a clue; otherwise no signal
  if(Math.random()<0.45){
    const hint = choose(scene.hints);
    elFlash.textContent = hint;
    elFlash.classList.add('show');
    // remove after animation finishes (0.85s)
    setTimeout(()=>{ elFlash.classList.remove('show'); }, 900);
  }
}

/* ====== Intensity UI ====== */
function renderIntensity(intensity){
  elIntensityBlock.innerHTML = '';
  const label = document.createElement('div');
  label.className='label'; label.textContent=intensity.label;

  const row = document.createElement('div'); row.className='row';
  const left = document.createElement('div'); left.style.fontWeight='900'; left.style.fontSize='18px';
  const right = document.createElement('div'); right.style.flex='1';

  const input = document.createElement('input'); input.type='range';
  input.min=intensity.min; input.max=intensity.max; input.step=intensity.step;

  if(intensity.type==='quantity'){
    intensityValue = intensity.min;
    left.textContent = `${intensityValue.toLocaleString()} ${intensity.unit}`;
    input.value=intensityValue;
    input.oninput = e=>{ intensityValue = Number(e.target.value); left.textContent = `${intensityValue.toLocaleString()} ${intensity.unit}`; };
  }else{
    intensityValue = intensity.min;
    left.textContent = `${intensityValue}${intensity.unit}`;
    input.value=intensityValue;
    input.oninput = e=>{ intensityValue = Number(e.target.value); left.textContent = `${intensityValue}${intensity.unit}`; };
  }

  right.appendChild(input); row.appendChild(left); row.appendChild(right);
  elIntensityBlock.appendChild(label); elIntensityBlock.appendChild(row);
}

/* ====== New Scenario ====== */
async function newScenario(){
  scene = choose(SCENES);

  // reset animations
  elTitle.style.animation='none'; void elTitle.offsetWidth; elTitle.style.animation=null;
  elReveal.style.display='none'; $('#outcomeBox').className='outcome';
  elControls.style.opacity=0;
  locked=false;

  // title + typewriter + controls
  elTitle.textContent = scene.title;
  await typewrite(elDesc, scene.text, 12);
  renderIntensity(scene.intensity);
  elControls.style.opacity=1;

  // randomised clue flash (not every turn)
  maybeFlashClue();
}

/* ====== Outcome Logic ======
   - Pick a bucket and sample multiplier
   - Scale extremes by intensity (volScale)
   - SAFETY: 0% => no change; <100% => cannot wipe out entirely
   - True wipeout possible ONLY at 100% intensity when bucket is catastrophic.
*/
function applyOutcome(){
  const intense = scene.intensity;
  let norm; // 0..1
  if(intense.type==='quantity'){
    norm = (intensityValue - intense.min) / (intense.max - intense.min);
  } else {
    norm = (intensityValue - intense.min) / (intense.max - intense.min);
  }
  norm = Math.max(0, Math.min(1, norm));

  // 0% participation: no move
  if((intense.type==='percent' && intensityValue===0) ||
     (intense.type==='quantity' && intensityValue===intense.min && intense.min===0)){
    showOutcome(1, "Sat out");
    return;
  }

  const bucket = pickWeighted(scene.outcomes);
  let mult = rand(bucket.mult[0], bucket.mult[1]);

  // amplify with volScale as intensity rises
  const vs = scene.volScale || 0.5;
  if(mult>=1){
    mult = 1 + (mult-1) * (1 + vs*norm);
  }else{
    mult = 1 - (1 - mult) * (1 + vs*norm);
    mult = Math.max(0, mult);
  }

  // safety rails:
  // - if intensity < 100% (or < max quantity), don't allow full zero; clamp to a survivable floor
  const isAllIn = (intense.type==='percent' && intensityValue===intense.max) ||
                  (intense.type==='quantity' && intensityValue===intense.max);
  if(!isAllIn){
    const floor = 0.15; // you can get wrecked, but never totalled unless all-in
    mult = Math.max(mult, floor);
  }

  showOutcome(mult, bucket.label);
}

function showOutcome(mult, label){
  const oldPrice = price;
  price = price * mult;

  elReveal.style.display='block';
  const cls = (price >= oldPrice) ? 'outcome good' : 'outcome bad';
  elOutcomeBox.className = `outcome ${cls}`;
  const pct = ((mult-1)*100).toFixed(1);
  elOutcomeBox.innerHTML = `
    <div class="big">${label} &nbsp; (${pct>0?'+':''}${pct}%)</div>
    <div>Price: <b>${fmtUSD(oldPrice,8)}</b> → <b>${fmtUSD(price,8)}</b></div>
    <div class="muted">Market Cap: <b>${fmtUSD(oldPrice*SUPPLY)}</b> → <b>${fmtUSD(mc())}</b></div>
  `;

  // TRUE wipeout only if all-in and multiplier ~0
  if(price<=0.0000000001){
    elNext.style.display='none';
    elRestart.style.display='inline-block';
  }else{
    elNext.style.display='inline-block';
    elRestart.style.display='none';
  }

  // Clear the day UI so the outcome fully owns attention
  elTitle.textContent = '';
  elDesc.textContent = '';
  elControls.style.opacity = 0;

  updateHUD();
}

/* ====== Flow ====== */
function nextDay(){
  if(price<=0.0000000001) return;
  day += 1;
  updateHUD();
  newScenario();
}
function restart(){
  day = 1;
  price = 10_000 / SUPPLY;
  updateHUD();
  newScenario();
}

/* ====== Init ====== */
(function init(){
  updateHUD();
  newScenario();
  elCommit.addEventListener('click', ()=>{ if(!locked){ locked=true; applyOutcome(); } });
  elNext.addEventListener('click', nextDay);
  elRestart.addEventListener('click', restart);
})();
</script>
</body>
</html>
